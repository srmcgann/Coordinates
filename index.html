<!DOCTYPE html>
<html>
  <head>
    <title>Coordinates boilerplate example</title>
    <style>
      body, html{
        background: #333;
        margin: 0;
        min-height: 100vh;
      }
    </style>
  </head>
  <body>
    <script type="module">
    
      import * as Coordinates from "./coordinates.js"
      
      var S = Math.sin
      var C = Math.cos
      
      //var refTexture = 'https://boss.mindhackers.org/assets/uploads/2fRBMj.mp4'
      var refTexture = 'https://boss.mindhackers.org/assets/uploads/1qpPWM.mp4'
    
      var rendererOptions = {
        ambientLight: -.5,
        fov: 1e3
      }
      var renderer = await Coordinates.Renderer(rendererOptions)
      
      var S = Math.sin
      var C = Math.cos
      var Rn = Math.random
      renderer.z = 16
      
      Coordinates.AnimationLoop(renderer, 'Draw')

      var shaderOptions = [
        {lighting: {
          type: 'ambientLight', value: -.25
        }},
        { uniform: {
          type: 'phong',
          value: 2.5
        } },
        
        { uniform: {
          type: 'reflection',
          value: .9,
          map: refTexture,
          flipReflections: false,
          playbackSpeed: .25
        } },
        
      ]
      var shader = await Coordinates.BasicShader(renderer, shaderOptions)

      // background shader
      shaderOptions = [
        { lighting: {
          type: 'ambientLight',
          value: .7
        }},
        { uniform: {
          type: 'phong',
          value: 0
        } },
      ]
      var backgroundShader = await Coordinates.BasicShader(renderer, shaderOptions)

      var shapes = []

      var geoOptions = {
        shapeType: 'dodecahedron',
        size: 14,
        subs: 3,
        color: 0x111111,
        colorMix: .2,
        equirectangular: true,
        sphereize: -.5,
        averageNormals: true,
        map: 'https://srmcgann.github.io/Coordinates/resources/nebugrid_po2.jpg'
      }
      await Coordinates.LoadGeometry(renderer, geoOptions).then(async (geometry) => {
        shapes.push(geometry)
        await shader.ConnectGeometry(geometry)
      })  
      
      var geoOptions = {
        shapeType: 'dodecahedron',
        name: 'background',
        size: 1e3,
        subs: 4,
        color: 0x000000,
        colorMix: 0,
        equirectangular: true,
        //sphereize: 0,
        //averageNormals: true,
        map: refTexture
      }
      await Coordinates.LoadGeometry(renderer, geoOptions).then(async (geometry) => {
        shapes.push(geometry)
        await backgroundShader.ConnectGeometry(geometry)
      })
      
      geoOptions = {
        shapeType: 'point light',
        name: 'point light',
        x: 14,
        size: 4,
        lum: 1.5,
        map: 'https://srmcgann.github.io/Coordinates/resources/stars/star4.png',
        pointLightShowSource: true
      }
      await Coordinates.LoadGeometry(renderer, geoOptions).then(async (geometry) => {
        shapes.push(geometry)
      })  
      
      
      window.Draw = () => {
        renderer.yaw += .0005
        renderer.pitch -= .01
        shapes.forEach(shape => {
          switch(shape.name){
            case 'point light':
              var X = shape.x
              var Y = shape.y
              var Z = shape.z
              var p = Math.atan2(X, Z) - .1
              var d = Math.hypot(X, Z)
              shape.x = S(p) * d
              shape.z = C(p) * d
            break
            case 'background':
            break
            default:
              shape.yaw += .01
              shape.pitch = C(renderer.t/2) / 3
            break
          }
          renderer.Draw(shape)
        })
      }
      
    </script>
  </body>
</html>