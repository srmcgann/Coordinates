const S=Math.sin,C=Math.cos,Rn=Math.random;var audioConsent=!1;const scratchCanvas=document.createElement("canvas"),sctx=scratchCanvas.getContext("2d",{alpha:!0,antialias:!0,desynchronized:!0,premultipliedAlpha:!1}),scratchImage=new Image,moduleBase="https://srmcgann.github.io/Coordinates";var cacheItem;const cache={objFiles:[],customShapes:[],textures:[],geometry:[],texImages:[]},Renderer=async e=>{var a=0,r=0,t=0,o=1920,n=1080,i=0,l=0,s=0,c=2e3,h=!0,f=10,p=!1,m=.2,u=!1,d={mode:"webgl2",options:{alpha:!0,antialias:!0,desynchronized:!0,premultipliedAlpha:!1}};void 0!==e&&Object.keys(e).forEach(((g,y)=>{switch(g.toLowerCase()){case"width":o=e[g];break;case"height":n=e[g];break;case"alpha":u=e[g];break;case"x":a=e[g];break;case"y":r=e[g];break;case"z":t=e[g];break;case"roll":i=e[g];break;case"pitch":l=e[g];break;case"yaw":s=e[g];break;case"fov":c=e[g];break;case"clearcolor":e[g];break;case"attachTobody":h=!!e[g];break;case"exportgpuspecs":p=!!e[g];break;case"margin":f=e[g];break;case"ambientlight":m=e[g];break;case"context":d.mode=e[g].mode,d.options=e[g].options}}));const g=document.createElement("canvas"),y=g.getContext(d.mode,d.options);g.width=o,g.height=n;const v=d[0];if(console.log(`GLSL version: ${y.getParameter(y.SHADING_LANGUAGE_VERSION)}`),p&&getParams(y),"2d"===v);else y.viewport(0,0,g.width,g.height);var R;h&&(g.style.display="block",g.style.position="absolute",g.style.left="50vw",g.style.top="50vh",g.style.transform="translate(-50%, -50%)",g.style.border="1px solid #fff3",g.style.background="#000",document.body.appendChild(g)),window.addEventListener("resize",R=e=>{var a,r=document.body,t=0!==g.width?g.height/g.width:1;r.clientHeight/r.clientWidth>t?(g.style.width=(a=r.clientWidth)-2*f+"px",g.style.height=a*t-2*f+"px"):(g.style.height=(a=r.clientHeight)-2*f+"px",g.style.width=a/t-2*f+"px")}),R();var A={c:g,ctx:y,contextType:v,t:0,alpha:u,width:o,height:n,x:a,y:r,z:t,roll:i,pitch:l,yaw:s,fov:c,ready:!1,ambientLight:m,pointLights:[],pointLightCols:[],spriteQueue:[]};A["2d"==v?"ctx":"gl"]=y;var b=A;b.Clear=()=>{if("2d"===v)g.width=b.c.width;else y.clearColor(0,0,0,1),y.clear(y.COLOR_BUFFER_BIT),y.clear(y.DEPTH_BUFFER_BIT)};return b.Draw=async(e,a=!1)=>{var r=e.shader.datasets[e.datasetIdx],t=r.program;if(void 0!==e?.shader)if(!a&&(e.isSprite||e.isLight&&e.showSource))b.spriteQueue=[e,...b.spriteQueue];else{y.useProgram(t),y.activeTexture(y.TEXTURE0),"video"==e.textureMode&&BindImage(y,r.resource,r.texture,e.textureMode,b.t,e.map),y.uniform1i(r.locTexture,r.texture),y.bindTexture(y.TEXTURE_2D,r.texture),y.uniform1i(r.locPointLightCount,b.pointLights.length);var o=new Float32Array,n=new Float32Array;b.pointLights.map((e=>{o=[...o,e.x,e.y,e.z,e.lum];HexToRGB(e.color);n=[...n,...HexToRGB(e.color),1]})),o.length&&(y.uniform4fv(r.locPointLights,o),y.uniform4fv(r.locPointLightCols,n));var i=b.ambientLight;r.optionalLighting.map((e=>{if("ambientLight"===e.name)i=e.value})),y.useProgram(t),r.optionalUniforms.map((a=>{if("object"==typeof a?.loc)switch(y[a.dataType](a.loc,a.value),y.uniform1f(a.locFlatShading,a.flatShading?1:0),a.name){case"reflection":y.activeTexture(y.TEXTURE1),"video"==a.textureMode&&BindImage(y,a.video,a.refTexture,a.textureMode,b.t,a.map),y.activeTexture(y.TEXTURE1),y.uniform1i(a.locRefTexture,1),y.bindTexture(y.TEXTURE_2D,a.refTexture),y.uniform1f(a.locRefOmitEquirectangular,"rectangle"==e.shapeType||"point light"==e.shapeType||"sprite"==e.shapeType?1:0);break;case"phong":a.locPhongTheta=y.getUniformLocation(r.program,"phongTheta"),y.uniform1f(a.locPhongTheta,a.theta)}})),y.uniform1f(r.locT,b.t),y.uniform1f(r.locColorMix,e.colorMix),y.uniform1f(r.locIsSprite,e.isSprite),y.uniform1f(r.locIsLight,e.isLight),y.uniform1f(r.locAlpha,e.alpha),y.uniform3f(r.locColor,...HexToRGB(e.color)),y.uniform1f(r.locAmbientLight,i/8),y.uniform2f(r.locResolution,b.width,b.height),y.uniform3f(r.locCamPos,b.x,b.y,b.z),y.uniform3f(r.locCamOri,b.roll,b.pitch,b.yaw),y.uniform3f(r.locGeoPos,e.x,e.y,e.z),y.uniform3f(r.locGeoOri,e.roll,e.pitch,e.yaw),y.uniform1f(r.locFov,b.fov),y.uniform1f(r.locEquirectangular,e.equirectangular?1:0),y.uniform1f(r.locRenderNormals,0),y.bindBuffer(y.ARRAY_BUFFER,e.uv_buffer),y.bufferData(y.ARRAY_BUFFER,e.uvs,y.STATIC_DRAW),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,e.UV_Index_Buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,e.uvIndices,y.STATIC_DRAW),y.vertexAttribPointer(r.locUv,2,y.FLOAT,!1,0,0),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,null),y.bindBuffer(y.ARRAY_BUFFER,null),e?.normalVecs.length&&(y.bindBuffer(y.ARRAY_BUFFER,e.normalVec_buffer),y.bufferData(y.ARRAY_BUFFER,e.normalVecs,y.STATIC_DRAW),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,e.NormalVec_Index_Buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,e.nIndices,y.STATIC_DRAW),y.bindBuffer(y.ARRAY_BUFFER,e.normalVec_buffer),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,e.NormalVec_Index_Buffer),r.locNormalVec=y.getAttribLocation(r.program,"normalVec"),y.vertexAttribPointer(r.locNormalVec,3,y.FLOAT,!1,0,0),y.enableVertexAttribArray(r.locNormalVec),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,null),y.bindBuffer(y.ARRAY_BUFFER,null)),e?.vertices?.length&&(y.bindBuffer(y.ARRAY_BUFFER,e.vertex_buffer),y.bufferData(y.ARRAY_BUFFER,e.vertices,y.STATIC_DRAW),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,e.Vertex_Index_Buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,e.vIndices,y.STATIC_DRAW),y.bindBuffer(y.ARRAY_BUFFER,e.vertex_buffer),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,e.Vertex_Index_Buffer),r.locPosition=y.getAttribLocation(r.program,"position"),y.vertexAttribPointer(r.locPosition,3,y.FLOAT,!1,0,0),y.enableVertexAttribArray(r.locPosition),y.drawElements(y.TRIANGLES,e.vertices.length/3|0,y.UNSIGNED_INT,0),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,null),y.bindBuffer(y.ARRAY_BUFFER,null)),y.uniform1f(r.locRenderNormals,e.showNormals?1:0),e.showNormals&&e?.normals?.length&&(y.bindBuffer(y.ARRAY_BUFFER,e.normal_buffer),y.bufferData(y.ARRAY_BUFFER,e.normals,y.STATIC_DRAW),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,e.Normal_Index_Buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,e.nIndices,y.STATIC_DRAW),y.vertexAttribPointer(r.locNormal,3,y.FLOAT,!1,0,0),r.locNormal=y.getAttribLocation(r.program,"normal"),y.bindBuffer(y.ARRAY_BUFFER,e.normal_buffer),y.bufferData(y.ARRAY_BUFFER,e.normals,y.STATIC_DRAW),y.enableVertexAttribArray(r.locNormal),y.drawElements(y.LINES,e.normals.length/3|0,y.UNSIGNED_INT,0),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,null),y.bindBuffer(y.ARRAY_BUFFER,null))}},b.nullShader=await BasicShader(b,[{uniform:{type:"phong",value:0}}]),b},DestroyViewport=e=>{e.remove()},DestroyShape=e=>{if("point light"===e.shapeType)e.renderer.pointLights=e.renderer.pointLights.filter(((a,r)=>r!=e.pointLightID)),e.renderer.pointLights.map(((e,a)=>e.pointLightID=a))},LoadOBJ=async(e,a,r,t,o,n,i,l,s=!0,c=!0)=>{var h,f={vertices:[],normals:[],uvs:[]};if(c&&(cacheItem=cache.objFiles.filter((a=>a.url==e))).length)f=cacheItem[0].ret;else{var p=new Float32Array,m=new Float32Array,u=new Float32Array,d=new Float32Array;await fetch(e).then((e=>e.text())).then((e=>{e.split("\n").forEach((e=>{var a=e.split(" ");switch(a[0]){case"v":a.shift(),p=[...p,a.map((e=>+e))];break;case"vt":a.shift(),u=[...u,a.map((e=>+e))];break;case"vn":a.shift(),m=[...m,a.map((e=>+e))];break;case"f":a.shift(),d=[...d,a.map((e=>e))]}})),d.map((e=>{var a,r,t,o=new Float32Array,n=new Float32Array,i=new Float32Array;e.map((e=>{var l=e.split("/");switch(l.length){case 1:a=l[0],o=[...o,p[a-1]];break;case 2:a=l[0],r=l[1],o=[...o,p[a-1]],n=[...n,u[r-1]];break;case 3:a=l[0],r=l[1],t=l[2],o=[...o,p[a-1]],n=[...n,u[r-1]],i=[...i,m[t-1]]}}));var l=o[0][0],s=o[0][1],c=o[0][2],d=o[1][0],g=o[1][1],y=o[1][2],v=o[2][0],R=o[2][1],A=o[2][2],b=i[0][0],E=i[0][1],x=i[0][2],_=i[1][0],F=i[1][1],M=i[1][2],T=i[2][0],I=i[2][1],w=i[2][2];if(4==o.length)var P=o[3][0],C=o[3][1],S=o[3][2],L=i[3][0],B=i[3][1],U=i[3][2];switch(o.length){case 3:h=new Float32Array,i.map(((e,a)=>{h=[...h,[l,s,c,l+b,s+E,c+x],[d,g,y,d+_,g+F,y+M],[v,R,A,v+T,R+I,A+w]]})),i=h,f.vertices=[...f.vertices,...o[0],...o[1],...o[2]],n.length&&void 0!==n[0]&&(f.uvs=[...f.uvs,...n[0],...n[1],...n[2]]),i.length&&void 0!==i[0]&&(f.normals=[...f.normals,...i[0],...i[1],...i[2]]);break;case 4:h=new Float32Array,i.map(((e,a)=>{h=[...h,[l,s,c,l+b,s+E,c+x],[d,g,y,d+_,g+F,y+M],[v,R,A,v+T,R+I,A+w],[P,C,S,P+L,C+B,S+U]]})),i=h,f.vertices=[...f.vertices,...o[0],...o[1],...o[2],...o[2],...o[3],...o[0]],n.length&&(f.uvs=[...f.uvs,...n[0],...n[1],...n[2],...n[2],...n[3],...n[0]]),i.length&&(f.normals=[...f.normals,...i[0],...i[1],...i[2],...i[2],...i[3],...i[0]])}}))})),cache.objFiles=[...cache.objFiles,{url:e,ret:f}]}for(var g=0;g<f.uvs.length;g+=2)f.uvs[g+1]=1-f.uvs[g+1];for(g=0;g<f.normals.length;g+=3)f.normals[g+1]=-f.normals[g+1];for(g=0;g<f.vertices.length;g+=3){var y=[f.vertices[g+0],f.vertices[g+1],f.vertices[g+2]];i&&(y=R(...y,{roll:0,pitch:i,yaw:0})),l&&(y=R(...y,{roll:0,pitch:0,yaw:l})),n&&(y=R(...y,{roll:n,pitch:0,yaw:0})),f.vertices[g+0]=y[0],f.vertices[g+1]=y[1],f.vertices[g+2]=y[2];for(var v=2;v--;){var A=v?2*g:2*g+3;y=[f.normals[A+0],f.normals[A+1],f.normals[A+2]];i&&(y=R(...y,{roll:0,pitch:i,yaw:0})),l&&(y=R(...y,{roll:0,pitch:0,yaw:l})),n&&(y=R(...y,{roll:n,pitch:0,yaw:0})),f.normals[A+0]=y[0],f.normals[A+1]=y[1],f.normals[A+2]=y[2]}}return f},Q=(e,a,r,t,o=700)=>[t.width/2+e/r*o,t.height/2+a/r*o],R=(e,a,r,t,o=!1)=>{var n,i,l=Math,s=l.hypot,c=l.atan2,h=t.roll,f=t.pitch,p=t.yaw;(e=S(n=c(e,a)+h)*(i=s(e,a)),a=C(n)*i,e=S(n=c(e,r)+p)*(i=s(e,r)),r=C(n)*i,a=S(n=c(a,r)+f)*(i=s(a,r)),r=C(n)*i,o)&&(e+=t.x,a+=t.y,r+=t.z);return[e,a,r]},LoadGeometry=async(e,a)=>{var r,t,o,n,i,l,s,c,h,f,p,m,u,d,g,y,v,A,b;const E=e.gl;var x,_=!1,F=0,M=0,T=0,I=0,w=0,P=0,C=1,S=1,L=1,B=16,U=40,N="",k="",O=1,D=!1,z=0,V=0,G=3355443,Y=.1,H=!1,X=!1,W=!1,K=!1,q="",j=!0,$=0,Q=0,Z=1,J=!0,ee=!1,ae=!1,re=1,te=1,oe=new Float32Array,ne=new Float32Array,ie={};a=structuredClone(a),Object.keys(a).forEach(((e,r)=>{if("showsource"===e.toLowerCase())ee=!!a[e]})),Object.keys(a).forEach(((e,s)=>{switch(e.toLowerCase()){case"x":F=a[e];break;case"y":M=a[e];break;case"z":T=a[e];break;case"roll":I=a[e];break;case"pitch":w=a[e];break;case"yaw":P=a[e];break;case"shapetype":switch(g=a[e].toLowerCase()){case"sprite":q=`${moduleBase}/resources/sprite.png`;break;case"point light":q=ee?`${moduleBase}/resources/stars/star.png`:""}break;case"size":O=a[e];break;case"subs":z=a[e];break;case"equirectangular":H=!!a[e];break;case"flipnormals":W=!!a[e];break;case"shownormals":K=!!a[e];break;case"sphereize":V=a[e];break;case"objx":r=a[e];break;case"objy":t=a[e];break;case"objz":o=a[e];break;case"objroll":n=a[e];break;case"objpitch":i=a[e];break;case"objyaw":l=a[e];break;case"scalex":C=a[e];break;case"scaley":S=a[e];break;case"scalez":L=a[e];break;case"name":k=a[e];break;case"color":G=a[e];break;case"colormix":Y=a[e];break;case"exportshape":_=!!a[e];break;case"url":N=a[e];break;case"map":q=a[e];break;case"rows":B=a[e];break;case"disabledepthtest":ae=a[e];break;case"cols":U=a[e];break;case"involvecache":J=!!a[e];break;case"muted":j=!!a[e];break;case"lum":re=a[e];break;case"alpha":te=a[e];break;case"geometrydata":oe=a[e];break;case"precomputenormalassocs":X=a[e];break;case"texcoords":ne=a[e];break;case"issprite":$=a[e]?1:0;break;case"islight":Q=a[e]?1:0;break;case"playbackspeed":Z=a[e];break;case"averagenormals":D=!!a[e];break;default:ie[e]=a[e]}})),V&&(D=!0);var le,se,ce=new Float32Array,he=new Float32Array,fe=new Float32Array,pe=new Float32Array,me=!1;if(-1!=g.indexOf("custom shape"))le=N,se=`${g} ${k} (${N})`;else if(se=`${g}_${z}`,z<5&&se)switch(se){case"tetrahedron_0":case"tetrahedron_1":case"tetrahedron_2":case"tetrahedron_3":case"tetrahedron_4":case"cube_0":case"cube_1":case"cube_2":case"cube_3":case"cube_4":case"octahedron_0":case"octahedron_1":case"octahedron_2":case"octahedron_3":case"octahedron_4":case"dodecahedron_0":case"dodecahedron_1":case"dodecahedron_2":case"dodecahedron_3":case"dodecahedron_4":case"icosahedron_0":case"icosahedron_1":case"icosahedron_2":case"icosahedron_3":case"icosahedron_4":case"cylinder_0":case"torus_0":case"torus knot_0":("cylinder_0"!=se||"torus_0"!=se||"cylinder_0"==se&&16==B&&40==U||"torus_0"==se&&16==B&&40==U||"torus knot_0"==se&&16==B&&40==U)&&(me=!0,le=`${N=`${moduleBase}/new%20shapes/`}${se}.json`)}if(me)await fetch(le).then((e=>e.json())).then((e=>{ce=e.vertices,he=e.normals,fe=e.normalVecs,pe=e.uvs,me=!0}));else if("custom shape"===g){if(J&&(cacheItem=cache.customShapes.filter((e=>e.url==N))).length){var ue=cacheItem[0].data;ce=ue.vertices,he=ue.normals,fe=ue.normalVecs,pe=ue.uvs,console.log("found custom shape found in cache. using it"),me=!0}me||await fetch(le).then((e=>e.json())).then((e=>{ce=e.vertices,he=e.normals,fe=e.normalVecs,pe=e.uvs,me=!0,cache.customShapes.push({data:e,url:N})}))}if(me)switch(g){case"tetrahedron":case"octahedron":case"dodecahedron":case"icosahedron":H=!0}else{switch(g){case"tetrahedron":H=!0,(x=await Tetrahedron(O,z,V,W,g)).geometry.map((e=>{ce=[...ce,...e.position],he=[...he,...e.normal],pe=[...pe,...e.texCoord]}));break;case"octahedron":H=!0,(x=await Octahedron(O,z,V,W,g)).geometry.map((e=>{ce=[...ce,...e.position],he=[...he,...e.normal],pe=[...pe,...e.texCoord]}));break;case"icosahedron":H=!0,(x=await Icosahedron(O,z,V,W,g)).geometry.map((e=>{ce=[...ce,...e.position],he=[...he,...e.normal],pe=[...pe,...e.texCoord]}));break;case"torus":(x=await Torus(O,z,V,W,g,B,U)).geometry.map((e=>{ce=[...ce,...e.position],he=[...he,...e.normal],pe=[...pe,...e.texCoord]}));break;case"torus knot":(x=await TorusKnot(O,z,V,W,g,B,U)).geometry.map((e=>{ce=[...ce,...e.position],he=[...he,...e.normal],pe=[...pe,...e.texCoord]}));break;case"cylinder":(x=await Cylinder(O,z,V,W,g,B,U)).geometry.map((e=>{ce=[...ce,...e.position],he=[...he,...e.normal],pe=[...pe,...e.texCoord]}));break;case"dynamic":(x=await GeometryFromRaw(oe,ne,O,z,V,W,!!oe.filter((e=>4==e.length)).length,"dynamic")).geometry.map((e=>{ce=[...ce,...e.position],he=[...he,...e.normal],void 0!==e.texCoord&&e.texCoord.length&&(pe=[...pe,...e.texCoord])}));break;case"cube":(x=await Cube(O,z,V,W,g)).geometry.map((e=>{ce=[...ce,...e.position],he=[...he,...e.normal],pe=[...pe,...e.texCoord]}));break;case"rectangle":(x=await Rectangle(O,z,V,W,g)).geometry.map((e=>{ce=[...ce,...e.position],he=[...he,...e.normal],pe=[...pe,...e.texCoord]}));break;case"sprite":$=!0,(x=await Rectangle(O,z,V,W,g)).geometry.map((e=>{ce=[...ce,...e.position],he=[...he,...e.normal],pe=[...pe,...e.texCoord]}));break;case"point light":Q=!0,(x=ee?await Rectangle(Math.max(O,.5),z-1,V,W,g):{geometry:[]}).geometry.map((e=>{ce=[...ce,...e.position],he=[...he,...e.normal],pe=[...pe,...e.texCoord]}));break;case"obj":void 0===r&&(r=0),void 0===t&&(t=0),void 0===o&&(o=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===l&&(l=0),x=await LoadOBJ(N,0,0,0,0,n,i,l,!1),ce=x.vertices,he=x.normals,pe=x.uvs;break;case"dodecahedron":H=!0,(x=await Dodecahedron(O,z,V,W,g)).geometry.map((e=>{ce=[...ce,...e.position],he=[...he,...e.normal],pe=[...pe,...e.texCoord]}))}for(var de=0;de<ce.length;de+=3)ce[de+0]*=C,ce[de+1]*=S,ce[de+2]*=L;if("obj"!=g&&"customShape"!=g)for(de=0;de<he.length;de+=6){var ge=he[de+3]-he[de+0],ye=he[de+4]-he[de+1],ve=he[de+5]-he[de+2];he[de+0]*=C,he[de+1]*=S,he[de+2]*=L,he[de+3]=he[de+0]+ge,he[de+4]=he[de+1]+ye,he[de+5]=he[de+2]+ve}}if("custom shape"!=g&&"obj"!=g||V||C||S||L){var Re=V,Ae=1-V;for(de=0;de<ce.length;de+=3){var be,Ee=ce[de+0],xe=ce[de+1],_e=ce[de+2];Ee/=be=Math.hypot(Ee,xe,_e)+1e-4,xe/=be,_e/=be,Ee*=Re+be*Ae,xe*=Re+be*Ae,_e*=Re+be*Ae,ce[de+0]=Ee*O*C,ce[de+1]=xe*O*S,ce[de+2]=_e*O*L;var Fe=he[2*de+0],Me=he[2*de+1],Te=he[2*de+2];he[2*de+0]+=ce[de+0]-Fe,he[2*de+1]+=ce[de+1]-Me,he[2*de+2]+=ce[de+2]-Te,he[2*de+3]+=ce[de+0]-Fe,he[2*de+4]+=ce[de+1]-Me,he[2*de+5]+=ce[de+2]-Te,he[2*de+0]*=C,he[2*de+1]*=S,he[2*de+2]*=L,he[2*de+3]*=C,he[2*de+4]*=S,he[2*de+5]*=L}}if(r||t||o||n||i||l){var Ie;void 0===r&&(r=0),void 0===t&&(t=0),void 0===o&&(o=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===l&&(l=0);for(de=0;de<he.length;de+=6)F=he[de+0],xe=he[de+1],_e=he[de+2],Ie=R(Ee,xe,_e,{roll:n,pitch:i,yaw:l},!1),he[de+0]=Ie[0]+r,he[de+1]=Ie[1]+t,he[de+2]=Ie[2]+o,F=he[de+3],xe=he[de+4],_e=he[de+5],Ie=R(Ee,xe,_e,{roll:n,pitch:i,yaw:l},!1),he[de+3]=Ie[0]+r,he[de+4]=Ie[1]+t,he[de+5]=Ie[2]+o;for(de=0;de<ce.length;de+=3)F=ce[de+0],xe=ce[de+1],_e=ce[de+2],Ie=R(Ee,xe,_e,{roll:n,pitch:i,yaw:l},!1),ce[de+0]=Ie[0]+r,ce[de+1]=Ie[1]+t,ce[de+2]=Ie[2]+o}if(D&&AverageNormals(ce,he,g),"dynamic"==g||X){ie.normalAssocs=new Float32Array;for(de=0;de<ce.length;de+=3){for(var we=ce[de+0],Pe=ce[de+1],Ce=ce[de+2],Se=new Float32Array,Le=0;Le<ce.length;Le+=3){var Be=ce[Le+0],Ue=ce[Le+1],Ne=ce[Le+2];Math.hypot(we-Be,Pe-Ue,Ce-Ne)<.001&&(Se=[...Se,Le])}ie.normalAssocs=[...ie.normalAssocs,Se]}}if(!me||D||_){fe=new Float32Array;for(de=0;de<he.length;de+=6){let e=he[de+3]-he[de+0],a=he[de+4]-he[de+1],r=he[de+5]-he[de+2];fe=[...fe,e,a,r]}}if(W&&!_){for(de=0;de<he.length;de+=6)he[de+3]=he[de+0]-(he[de+3]-he[de+0]),he[de+4]=he[de+1]-(he[de+4]-he[de+1]),he[de+5]=he[de+2]-(he[de+5]-he[de+2]);for(de=0;de<fe.length;de+=3)fe[de+0]*=-1,fe[de+1]*=-1,fe[de+2]*=-1}if(_&&"background"!==k){var ke=document.createElement("div");ke.style.position="fixed",ke.style.zIndex=1e5,ke.style.left="50%",ke.style.top="50%",ke.style.transform="translate(-50%, -50%)",ke.style.background="#0008",ke.style.padding="20px",ke.style.width="600px",ke.style.height="350px",ke.style.border="1px solid #fff4",ke.style.borderRadius="5px",ke.style.fontFamily="monospace",ke.style.fontSize="20px",ke.style.color="#fff";var Oe=document.createElement("div");Oe.style.fontSize="24px",Oe.style.color="#0f8c",Oe.innerHTML=`Export Coordinates File -> ${g} `+(a?.name?`(${a.name})`:"")+"<br><br>",ke.appendChild(Oe);var De=document.createElement("div");De.style.minWidth="100%",De.style.height="250px",De.style.background="#333",De.style.border="1px solid #fff4",De.style.overflowY="auto",De.style.wordWrap="break-word",De.style.color="#888",De.style.fontSize="10px",ke.appendChild(De);var ze=document.createElement("button");ze.style.border="none",ze.style.padding="3px",ze.style.cursor="pointer",ze.fontSize="20px",ze.style.borderRadius="10px",ze.style.margin="10px",ze.style.minWidth="100px",ze.innerHTML="📋 copy",ze.title="copy shape data to clipboard",ze.onclick=()=>{var e=document.createRange();e.selectNode(De),window.getSelection().removeAllRanges(),window.getSelection().addRange(e),document.execCommand("copy"),window.getSelection().removeAllRanges(),ze.innerHTML="COPIED!",setTimeout((()=>{ze.innerHTML="📋 copy"}),1e3)},ke.appendChild(ze);var Ve=document.createElement("button");Ve.onclick=()=>ke.remove(),Ve.style.border="none",Ve.style.padding="3px",Ve.style.cursor="pointer",Ve.fontSize="20px",Ve.style.borderRadius="10px",Ve.style.margin="10px",Ve.style.background="#faa",Ve.style.minWidth="100px",Ve.innerHTML="close",ke.appendChild(Ve);var Ge={vertices:[],normals:[],normalVecs:[],uvs:[]};ce.map((e=>Ge.vertices.push(Math.round(1e3*e)/1e3)));for(de=0;de<he.length;de+=6){we=he[de+0],Pe=he[de+1],Ce=he[de+2],Be=W?he[de+0]-(he[de+3]-he[de+0]):he[de+3],Ue=W?he[de+1]-(he[de+4]-he[de+1]):he[de+4],Ne=W?he[de+2]-(he[de+5]-he[de+2]):he[de+5];we=Math.round(1e3*we)/1e3,Pe=Math.round(1e3*Pe)/1e3,Ce=Math.round(1e3*Ce)/1e3,Be=Math.round(1e3*Be)/1e3,Ue=Math.round(1e3*Ue)/1e3,Ne=Math.round(1e3*Ne)/1e3,Ge.normals.push(we,Pe,Ce,Be,Ue,Ne)}for(de=0;de<fe.length;de++)Ge.normalVecs.push((W?-1:1)*Math.round(1e3*fe[de])/1e3);pe.map((e=>Ge.uvs.push(Math.round(1e3*e)/1e3))),De.innerHTML=JSON.stringify(Ge),document.body.appendChild(ke)}ce=new Float32Array(ce),he=new Float32Array(he),fe=new Float32Array(fe),pe=new Float32Array(pe),s=E.createBuffer(),E.bindBuffer(E.ARRAY_BUFFER,s),E.bufferData(E.ARRAY_BUFFER,ce,E.STATIC_DRAW),E.bindBuffer(E.ARRAY_BUFFER,null),y=new Uint32Array(Array(ce.length/3).fill().map(((e,a)=>a))),c=E.createBuffer(),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,c),E.bufferData(E.ELEMENT_ARRAY_BUFFER,y,E.STATIC_DRAW),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,null),p=E.createBuffer(),E.bindBuffer(E.ARRAY_BUFFER,p),E.bufferData(E.ARRAY_BUFFER,fe,E.STATIC_DRAW),E.bindBuffer(E.ARRAY_BUFFER,null),A=new Uint32Array(Array(fe.length/3).fill().map(((e,a)=>a))),m=E.createBuffer(),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,m),E.bufferData(E.ELEMENT_ARRAY_BUFFER,A,E.STATIC_DRAW),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,null),h=E.createBuffer(),E.bindBuffer(E.ARRAY_BUFFER,h),E.bufferData(E.ARRAY_BUFFER,he,E.STATIC_DRAW),E.bindBuffer(E.ARRAY_BUFFER,null),v=new Uint32Array(Array(he.length/3).fill().map(((e,a)=>a))),f=E.createBuffer(),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,f),E.bufferData(E.ELEMENT_ARRAY_BUFFER,v,E.STATIC_DRAW),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,null),u=E.createBuffer(),E.bindBuffer(E.ARRAY_BUFFER,u),E.bufferData(E.ARRAY_BUFFER,pe,E.STATIC_DRAW),E.bindBuffer(E.ARRAY_BUFFER,null),b=new Uint32Array(Array(pe.length/2).fill().map(((e,a)=>a))),d=E.createBuffer(),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,d),E.bufferData(E.ELEMENT_ARRAY_BUFFER,b,E.STATIC_DRAW),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,null);var Ye={x:F,y:M,z:T,roll:I,pitch:w,yaw:P,color:G,colorMix:Y,size:O,subs:z,name:k,url:N,averageNormals:D,showNormals:K,shapeType:g,exportShape:_,sphereize:V,equirectangular:H,flipNormals:W,vertices:ce,normals:he,normalVecs:fe,uvs:pe,vertex_buffer:s,Vertex_Index_Buffer:c,normal_buffer:h,Normal_Index_Buffer:f,muted:j,normalVec_buffer:p,NormalVec_Index_Buffer:m,nVecIndices:A,uv_buffer:u,UV_Index_Buffer:d,vIndices:y,nIndices:v,uvIndices:b,map:q,video:undefined,textureMode:"image",isSprite:$,isLight:Q,playbackSpeed:Z,disableDepthTest:ae,lum:re,alpha:te,involveCache:J,renderer:e};return Object.keys(Ye).forEach(((e,a)=>{ie[e]=Ye[e]})),"point light"!=g&&"sprite"!=g||(void 0===a.color&&(ie.color=11184810),"point light"==g&&(ie.pointLightID=e.pointLights.length,e.pointLights.push(ie))),await e.nullShader.ConnectGeometry(ie),ie},GenericPopup=async(e="",a=!1,r=(()=>{}),t=400,o=300)=>{var n=document.createElement("div");n.style.position="fixed",n.style.zIndex=1e5,n.style.left="50%",n.style.top="50%",n.style.transform="translate(-50%, -50%)",n.style.background="#0008",n.style.padding="20px",n.style.width=`${t}px`,n.style.height=`${o}px`,n.style.border="1px solid #fff4",n.style.borderRadius="5px",n.style.fontFamily="monospace",n.style.fontSize="20px",n.style.color="#fff";var i=document.createElement("div");if(i.style.fontSize="24px",i.style.color="#0f8c",i.innerHTML=e,n.appendChild(i),a){var l=document.createElement("button");l.onclick=()=>{r(),n.remove()},l.style.border="none",l.style.padding="3px",l.style.cursor="pointer",l.fontSize="20px",l.style.borderRadius="10px",l.style.margin="10px",l.style.background="#faa",l.style.minWidth="100px",l.innerHTML="SURE!",n.appendChild(l)}var s=document.createElement("button");s.onclick=()=>n.remove(),s.style.border="none",s.style.padding="3px",s.style.cursor="pointer",s.fontSize="20px",s.style.borderRadius="10px",s.style.margin="10px",s.style.background="#faa",s.style.minWidth="100px",s.innerHTML="close",n.appendChild(s),document.body.appendChild(n)},ImageToPo2=e=>{let a=e;if(!IsPowerOf2(e.width)||!IsPowerOf2(e.height)){let r,t,o=document.createElement("canvas"),n=o.getContext("2d"),i=8,l=0,s=6e6,c=Math.hypot(e.width,e.height);for(let e=0;e<16;e++)(r=Math.abs(l-c))<s&&(s=r,l=i*2**e,t=e);l-=i*2**(t-1),o.width=l,o.height=l,n.drawImage(e,0,0,o.width,o.height),a=new Image,a=o}return a},VideoToImage=e=>{if(void 0!==e){let a,r;if(scratchCanvas.width!=e.videoWidth||scratchCanvas.height!=e.videoHeight?(a=e.videoWidth,r=e.videoHeight):(a=scratchCanvas.width,r=scratchCanvas.height),!IsPowerOf2(a)||!IsPowerOf2(r)){let e,t,o=8,n=0,i=6e6,l=Math.hypot(a,r);for(let a=0;a<12;a++)(e=Math.abs(n-l))<i&&(i=e,n=o*2**a,t=a);n-=o*2**(t-1),n=Math.min(512,n),a=n/1,r=n/1}return scratchCanvas.width=a,scratchCanvas.height=r,sctx.drawImage(e,0,0,scratchCanvas.width,scratchCanvas.height),scratchCanvas}return scratchCanvas.width=1,scratchCanvas.height=1,scratchCanvas},BindImage=(e,a,r,t="image",o=-1,n="",i=!0)=>{let l;switch(t){case"video":i&&(cacheItem=cache.texImages.filter((e=>e.url==n&&-1!=o&&e.tVal==o))).length?(console.log("found video texture in cache... using it"),l=cacheItem[0].texImage):(l=VideoToImage(a),-1==o&&cache.texImages.push({url:n,tval:o,texImage:l}));break;case"image":i&&(cacheItem=cache.texImages.filter((e=>e.url==n))).length?(console.log("found image texture in cache... using it"),l=cacheItem[0].texImage):(l=ImageToPo2(a),-1==o&&cache.texImages.push({url:n,tval:o,texImage:l}))}e.bindTexture(e.TEXTURE_2D,r),l.width&&l.height&&e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)},SyncNormals=(e,a=!1)=>{for(var r,t,o,n,i=e.vertices,l=new Float32Array,s=new Float32Array,c=0;c<i.length;c+=3)if(r=i[c+0],t=i[c+1],o=i[c+2],s=[...s,[r,t,o]],c%9==6){var h=Normal(s);l=[...l,h,h,h],s=new Float32Array}if(a){var f=new Float32Array;for(c=0;c<i.length;c+=3){var p=i[c+0],m=i[c+1],u=i[c+2],d=c/3|0,g=(l[d][3],l[d][0],l[d][4],l[d][1],l[d][5],l[d][2],0);n=[0,0,0],e.normalAssocs[d].map((e=>{var a=e/3|0;n[0]+=l[a][3]-l[a][0],n[1]+=l[a][4]-l[a][1],n[2]+=l[a][5]-l[a][2],g++})),n[0]/=g,n[1]/=g,n[2]/=g,f=[...f,...n],e.normals[2*c+0]=p,e.normals[2*c+1]=m,e.normals[2*c+2]=u,e.normals[2*c+3]=p+n[0],e.normals[2*c+4]=m+n[1],e.normals[2*c+5]=u+n[2]}for(h=e.normalVecs,c=0;c<h.length;c++)h[c]=f[c]}},AverageNormals=(e,a,r)=>{a.length=0;for(var t,o=IsPolyhedron(r),n=0;n<e.length;n+=3)n%9||(t=Normal([[e[n+0],e[n+1],e[n+2]],[e[n+3],e[n+4],e[n+5]],[e[n+6],e[n+7],e[n+8]]],o)),a[2*n+0]=e[n+0],a[2*n+1]=e[n+1],a[2*n+2]=e[n+2],a[2*n+3]=e[n+0]+(t[0]-t[3]),a[2*n+4]=e[n+1]+(t[1]-t[4]),a[2*n+5]=e[n+2]+(t[2]-t[5]);new Float32Array;var i,l,s,c,h,f,p,m,u,d,g,y,v,R=structuredClone(a);for(n=0;n<a.length;n+=6){h=a[n+0],f=a[n+1],p=a[n+2],l=a[n+3],s=a[n+4],c=a[n+5],i=1;for(var A=0;A<a.length;A+=6)A!=n&&(m=a[A+0],u=a[A+1],d=a[A+2],g=a[A+3],y=a[A+4],v=a[A+5],Math.hypot(h-m,f-u,p-d)<.01&&(l+=g,s+=y,c+=v,i++));R[n+3]=l/=i,R[n+4]=s/=i,R[n+5]=c/=i}R.map(((e,r)=>a[r]=e))},BasicShader=async(e,a=[])=>{const r=e.gl;var t={iURL:null,locT:null,locUv:null,locFov:null,program:null,optionalUniforms:[],optionalLighting:[]};a.map((a=>{Object.keys(a).forEach(((r,o)=>{switch(r.toLowerCase()){case"lighting":if("ambientlight"===a[r].type.toLowerCase())if(void 0===a[r]?.enabled||a[r].enabled){var n={name:a[r].type,value:void 0===a[r].value?e.ambientLight:a[r].value};t.optionalLighting.push(n)}break;case"uniform":switch(a[r].type.toLowerCase()){case"reflection":if(void 0===a[r]?.enabled||a[r].enabled){var i={name:a[r].type,playbackSpeed:void 0===a[r].playbackSpeed?1:a[r].playbackSpeed,involveCache:void 0===a[r].involveCache||a[r].involveCache,muted:void 0===a[r].muted||a[r].muted,map:a[r].map,loc:"locReflection",value:void 0===a[r].value?.5:a[r].value,flatShading:void 0!==a[r].flatShading&&a[r].flatShading,flipReflections:void 0!==a[r].flipReflections&&a[r].flipReflections,flatShadingUniform:"refFlatShading",dataType:"uniform1f",vertDeclaration:"\n                    varying vec3 reflectionPos;\n                  ",vertCode:"\n                    reflectionPos = R(nVeci, geoOri);\n                  ",fragDeclaration:"\n                    uniform float reflection;\n                    uniform float refFlatShading;\n                    uniform float refOmitEquirectangular;\n                    uniform float refFlipRefs;\n                    uniform sampler2D reflectionMap;\n                    varying vec3 reflectionPos;\n                  ",fragCode:"\n                    //light.rgb *= .5;\n                    //light.rgb += .05;\n                    float refP1, refP2;\n                    if(refOmitEquirectangular != 1.0){\n                      float px = reflectionPos.x;\n                      float py = reflectionPos.y;\n                      float pz = reflectionPos.z;\n                      refP1 = -atan(px, pz)/ M_PI / 2.0;\n                      refP2 = acos( py / (.001 + sqrt(px * px + py * py + pz * pz))) / M_PI;\n                      if(refFlipRefs != 0.0) refP2 = 1.0 - refP2;\n                    } else {\n                      refP1 = vUv.x;\n                      refP2 = vUv.y;\n                    }\n                    \n                    vec2 refCoords = vec2(1.0 - refP1, refP2);\n                    vec4 refCol = vec4(texture2D(reflectionMap, vec2(refCoords.x, refCoords.y)).rgb * 1.25, reflection / 1.0);\n                    mixColor = merge(mixColor, refCol);\n                    baseColorIp = 1.0 - reflection;\n                    //light += reflection / 4.0;\n                  "};t.optionalUniforms.push(i)}break;case"phong":if(void 0===a[r]?.enabled||a[r].enabled){i={name:a[r].type,loc:"locPhong",value:void 0===a[r].value?.3:a[r].value,flatShading:void 0!==a[r].flatShading&&a[r].flatShading,flatShadingUniform:"phongFlatShading",theta:void 0===a[r].theta?Math.PI+.5:a[r].theta,dataType:"uniform1f",vertDeclaration:"\n                    varying vec3 phongPos;\n                  ",vertCode:"\n                    phongPos = nVec; //R(nVeci, geoOri);\n                    hasPhong = 1.0;\n                  ",fragDeclaration:"\n                    uniform float phong;\n                    uniform float phongTheta;\n                    uniform float phongFlatShading;\n                    varying vec3 phongPos;\n                  ",fragCode:"\n                    if(isLight == 0.0 && isSprite == 0.0){\n                      //light.rgb *= .5;\n                      float phongP1, phongP2;\n                      float px, py, pz;\n                      if(phongFlatShading != 0.0){\n                        px = 0.0;\n                        py = 0.0;\n                        pz = 0.0;\n                      }else{\n                        px = phongPos.x;\n                        py = phongPos.y;\n                        pz = phongPos.z;\n                      }\n                      phongP1 = atan(px, pz) + phongTheta;\n                      phongP2 = -acos( py / (.001 + sqrt(px * px + py * py + pz * pz)));\n\n                      float fact = pow(pow((1.0+cos(phongP1)) * (1.0+cos(phongP2+M_PI/2.0-.2)), 3.0), 3.0) / 5e5 * phong ;\n                      light = vec4(light.rgb + fact, 1.0) * 25.0;\n                    }\n                  "};t.optionalUniforms.push(i)}}}}))}));let o={ConnectGeometry:null,datasets:[]};r.enable(r.DEPTH_TEST),r.cullFace(r.BACK),e.alpha&&(r.blendFunc(r.SRC_ALPHA,r.ONE),r.enable(r.BLEND),r.disable(r.DEPTH_TEST));let n="";t.optionalUniforms.map((e=>{n+="\n"+e.vertDeclaration+"\n"}));let i="";t.optionalUniforms.map((e=>{i+="\n"+e.vertCode+"\n"}));let l="";t.optionalUniforms.map((e=>{l+="\n"+e.fragDeclaration+"\n"}));let s="";t.optionalUniforms.map((e=>{s+="\n"+e.fragCode+"\n"})),o.vert=`\n    precision highp float;\n    #define M_PI 3.14159265358979323\n    attribute vec2 uv;\n    ${n}\n    \n    uniform float t;\n    uniform vec3 color;\n    uniform float ambientLight;\n    uniform vec3 camPos;\n    uniform vec3 camOri;\n    uniform vec3 geoPos;\n    uniform vec3 geoOri;\n    uniform float isSprite;\n    uniform float isLight;\n    //uniform vec4 pointLightPos[16];\n    uniform float fov;\n    uniform float equirectangular;\n    uniform float renderNormals;\n    uniform vec2 resolution;\n    attribute vec3 position;\n    attribute vec3 normal;\n    attribute vec3 normalVec;\n    varying vec2 vUv;\n    varying vec2 uvi;\n    varying vec3 nVec;\n    varying vec3 nVeci;\n    varying vec3 fPos;\n    varying vec3 fPosi;\n    varying vec3 vnorm;\n    varying float skip;\n    varying float hasPhong;\n    \n    \n    vec3 R(vec3 pos, vec3 rot){\n      float p, d;\n      pos.x = sin(p=atan(pos.x,pos.z)+rot.z)*(d=sqrt(pos.x*pos.x+pos.z*pos.z));\n      pos.z = cos(p)*d;\n      pos.y = sin(p=atan(pos.y,pos.z)+rot.y)*(d=sqrt(pos.y*pos.y+pos.z*pos.z));\n      pos.z = cos(p)*d;\n      pos.x = sin(p=atan(pos.x,pos.y)+rot.x)*(d=sqrt(pos.x*pos.x+pos.y*pos.y));\n      pos.y = cos(p)*d;\n      return pos;\n    }\n    \n    void main(){\n      hasPhong = 0.0;\n      \n      float cx, cy, cz;\n      if(renderNormals == 1.0){\n        cx = normal.x;\n        cy = normal.y;\n        cz = normal.z;\n      }else{\n        cx = position.x;\n        cy = position.y;\n        cz = position.z;\n      }\n      \n      \n      uvi = uv / 2.0;\n      uvi = vec2(uvi.x, .5 - uvi.y);\n      \n      nVeci = normalVec;\n      \n      fPosi = position;\n      vnorm = normal;\n      \n      \n      // camera rotation\n      \n      vec3 geo, pos;\n      \n      if(isSprite != 0.0 || isLight != 0.0){\n        \n        geo = R(geoPos, camOri);\n        pos = R(vec3(cx, cy, cz),\n                 vec3(0.0, -camOri.y + M_PI, 0.0));\n        pos = R(vec3(pos.x, pos.y, pos.z),\n                 vec3(-camOri.x, 0.0, -camOri.z ));\n        pos = R(vec3(pos.x, pos.y, pos.z), camOri);\n        nVec = vec3(normalVec.x, normalVec.y, normalVec.z);\n        nVec = R(nVec, geoOri);\n        nVec = R(nVec, vec3(0.0, camOri.y, camOri.z));\n\n      }else{\n        geo = R(geoPos, camOri);\n        pos = R(vec3(cx, cy, cz), geoOri);\n        pos = R(vec3(pos.x, pos.y, pos.z), camOri);\n        nVec = vec3(normalVec.x, normalVec.y, normalVec.z);\n        nVec = R(nVec, geoOri);\n        nVec = R(nVec, vec3(0.0, camOri.y, camOri.z));\n      }\n      fPos = vec3(pos.x, pos.y, pos.z);\n      \n      ${i}\n      \n      float camz = camPos.z / 1e3 * pow(5.0, (log(fov) / 1.609438));\n      \n      float Z = pos.z + camz + geo.z;\n      if(Z > 0.0) {\n        float X = ((pos.x + camPos.x + geo.x) / Z * fov / resolution.x);\n        float Y = ((pos.y + camPos.y + geo.y) / Z * fov / resolution.y);\n        //gl_PointSize = 100.0 / Z;\n        gl_Position = vec4(X, Y, Z/100000.0, 1.0);\n        skip = 0.0;\n        vUv = uv;\n      }else{\n        skip = 1.0;\n      }\n    }\n  `,o.frag=`\n    precision highp float;\n    #define M_PI 3.14159265358979323\n    ${l}\n    uniform float t;\n    uniform vec2 resolution;\n    uniform float flatShading;\n    uniform float isSprite;\n    uniform float isLight;\n    uniform vec4 pointLightPos[128];\n    uniform vec4 pointLightCol[128];\n    uniform int pointLightCount;\n    uniform float ambientLight;\n    uniform float renderNormals;\n    uniform float equirectangular;\n    uniform float colorMix;\n    uniform vec3 color;\n    uniform sampler2D baseTexture;\n    uniform float alpha;\n    uniform vec3 camPos;\n    uniform vec3 camOri;\n    uniform vec3 geoPos;\n    uniform vec3 geoOri;\n    varying vec2 vUv;\n    varying vec2 uvi;\n    varying vec3 vnorm;\n    varying vec3 nVec;\n    varying vec3 nVeci;\n    varying vec3 fPos;\n    varying vec3 fPosi;\n    varying float skip;\n    varying float hasPhong;\n\n    vec4 merge (vec4 col1, vec4 col2){\n      return vec4((col1.rgb * col1.a) + (col2.rgb * col2.a), 1.0);\n    }\n    \n    vec2 Coords(float flatShading) {\n      if(equirectangular == 1.0){\n        float p;\n        float p2;\n        p = flatShading == 1.0 ? atan(nVeci.x, nVeci.z): atan(fPosi.x, fPosi.z);\n        float p1;\n        p1 = p / M_PI / 2.0;\n        p2 = flatShading == 1.0 ?\n              acos(nVeci.y / (sqrt(nVeci.x*nVeci.x + nVeci.y*nVeci.y + nVec.z*nVeci.z)+.00001)) / M_PI   :\n              p2 = acos(fPosi.y / (sqrt(fPosi.x*fPosi.x + fPosi.y*fPosi.y + fPosi.z*fPosi.z)+.00001)) / M_PI;\n        return vec2(p1, p2);\n      }else{\n        return vUv;\n      }\n    }\n\n    vec3 R(vec3 pos, vec3 rot){\n      float p, d;\n      pos.x = sin(p=atan(pos.x,pos.z)+rot.z)*(d=sqrt(pos.x*pos.x+pos.z*pos.z));\n      pos.z = cos(p)*d;\n      pos.y = sin(p=atan(pos.y,pos.z)+rot.y)*(d=sqrt(pos.y*pos.y+pos.z*pos.z));\n      pos.z = cos(p)*d;\n      pos.x = sin(p=atan(pos.x,pos.y)+rot.x)*(d=sqrt(pos.x*pos.x+pos.y*pos.y));\n      pos.y = cos(p)*d;\n      return pos;\n    }\n    \n    vec4 GetPointLight(){\n      \n      float ret = 0.0;\n      vec4 rgba = vec4(0.0, 0.0, 0.0, 1.0);\n      for(int i=0; i < 16; i++){\n        if(i >= pointLightCount) break;\n        vec3 lpos = pointLightPos[i].xyz;\n        lpos.x -= geoPos.x;\n        lpos.y -= geoPos.y;\n        lpos.z -= geoPos.z;\n        lpos = R(lpos, vec3(camOri.x, 0.0, camOri.z ));\n        lpos = R(lpos, vec3(0.0, camOri.y, 0.0));\n\n        float mag = pointLightPos[i].w;\n        ret = mag / (1.0 + pow(1.0 + sqrt((lpos.x-fPos.x) * (lpos.x-fPos.x) +\n                     (lpos.y-fPos.y) * (lpos.y-fPos.y) +\n                     (lpos.z-fPos.z) * (lpos.z-fPos.z)), 2.0) / 3.0) * 40.0;\n        \n        rgba.r += ret * pointLightCol[i].r;\n        rgba.g += ret * pointLightCol[i].g;\n        rgba.b += ret * pointLightCol[i].b;\n      }\n      \n      return pointLightCount > 0 ? vec4(rgba.rgb + ambientLight, 1.0) : vec4(ambientLight, ambientLight, ambientLight, 1.0);\n    }\n\n    void main() {\n      float mixColorIp = colorMix;\n      float baseColorIp = 1.0 - mixColorIp;\n      vec4 mixColor = vec4(color.rgb, mixColorIp);\n      vec4 light = hasPhong == 1.0 ? GetPointLight() :\n            vec4(ambientLight, ambientLight, ambientLight, 1.0);\n      float colorMag = 1.0;\n      if(skip != 1.0){\n        if(renderNormals == 1.0){\n          gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n        }else{\n          ${s}\n          vec4 texel = texture2D( baseTexture, Coords(0.0));\n          if(isSprite != 0.0 || isLight != 0.0){\n            gl_FragColor = vec4(texel.rgb * 2.0, texel.a * alpha);\n          }else{\n            texel.a = baseColorIp;\n            vec4 col = merge(mixColor, texel);\n            col.rgb *= light.rgb;\n            gl_FragColor = vec4(col.rgb * colorMag, 1.0);\n          }\n        }\n      }\n    }\n  `;const c=r.createShader(r.VERTEX_SHADER);r.shaderSource(c,o.vert),r.compileShader(c);const h=r.createShader(r.FRAGMENT_SHADER);return r.shaderSource(h,o.frag),r.compileShader(h),o.ConnectGeometry=async(a,n=!1)=>{var i=a.involveCache,l=structuredClone(t);o.datasets=[...o.datasets,l],l.program=r.createProgram(),r.attachShader(l.program,c),r.attachShader(l.program,h),r.linkProgram(l.program),a.shader=o;var s=a.map;if(a.datasetIdx=o.datasets.length-1,r.getProgramParameter(l.program,r.LINK_STATUS)){if(r.useProgram(l.program),r.bindBuffer(r.ARRAY_BUFFER,a.vertex_buffer),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a.Vertex_Index_Buffer),l.locPosition=r.getAttribLocation(l.program,"position"),r.vertexAttribPointer(l.locPosition,3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(l.locPosition),r.bindBuffer(r.ARRAY_BUFFER,a.uv_buffer),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a.UV_Index_Buffer),l.locUv=r.getAttribLocation(l.program,"uv"),r.vertexAttribPointer(l.locUv,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(l.locUv),r.bindBuffer(r.ARRAY_BUFFER,a.normal_buffer),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a.Normal_Index_Buffer),l.locNormal=r.getAttribLocation(l.program,"normal"),r.vertexAttribPointer(l.locNormal,3,r.FLOAT,!0,0,0),r.enableVertexAttribArray(l.locNormal),r.bindBuffer(r.ARRAY_BUFFER,a.normalVec_buffer),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a.NormalVec_Index_Buffer),l.locNormalVec=r.getAttribLocation(l.program,"normalVec"),r.vertexAttribPointer(l.locNormalVec,3,r.FLOAT,!0,0,0),r.enableVertexAttribArray(l.locNormalVec),!n){if(a.isLight||l.optionalUniforms.map((async e=>{switch(e.name){case"reflection":var t=e.map;if(t){let a,l=(a=t.split("."))[a.length-1].toLowerCase();switch(e.refTexture=r.createTexture(),l){case"mp4":case"webm":case"avi":case"mkv":case"ogv":e.textureMode="video",i&&(cacheItem=cache.textures.filter((e=>e.url==t))).length?(console.log("found video in cache... using it"),e.video=cacheItem[0].resource,o.datasets=[...o.datasets,{texture:cacheItem[0].texture,iURL:t}]):(e.video=document.createElement("video"),e.video.muted=!0,e.video.playbackRate=e.playbackSpeed,e.video.defaultPlaybackRate=e.playbackSpeed,o.datasets=[...o.datasets,{texture:e.refTexture,iURL:t}],e.video.loop=!0,e.muted||audioConsent||(audioConsent=!0,GenericPopup("play audio OK?",!0,(()=>{cache.textures.filter((e=>e.url==t))[0].resource.muted=!1,cache.textures.filter((e=>e.url==t))[0].resource.currentTime=0,cache.textures.filter((e=>e.url==t))[0].resource.play()}))),e.video.playbackRate=e.video.defaultPlaybackRate=e.playbackSpeed,e.video.oncanplay=async()=>{e.video.play()},cache.textures.push({url:t,resource:e.video,texture:e.refTexture}),await fetch(t).then((e=>e.blob())).then((a=>{e.video.src=URL.createObjectURL(a)})));break;default:e.textureMode="image";var n=new Image;o.datasets=[...o.datasets,{texture:e.refTexture,iURL:t}],r.activeTexture(r.TEXTURE1),n.onload=()=>{BindImage(r,n,e.refTexture,e.textureMode,-1,t)},cache.textures.push({url:t,resource:n,texture:e.refTexture}),await fetch(t).then((e=>e.blob())).then((e=>{n.src=URL.createObjectURL(e)}))}}r.useProgram(l.program),e.locRefOmitEquirectangular=r.getUniformLocation(l.program,"refOmitEquirectangular"),r.uniform1f(e.locRefOmitEquirectangular,"rectangle"==a.shapeType||"point light"==a.shapeType||"sprite"==a.shapeType?1:0),e.locRefFlipRefs=r.getUniformLocation(l.program,"refFlipRefs"),r.uniform1f(e.locRefFlipRefs,e.flipReflections),e.locRefTexture=r.getUniformLocation(l.program,"reflectionMap"),r.bindTexture(r.TEXTURE_2D,e.refTexture),r.uniform1i(e.locRefTexture,1),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,e.refTexture);break;case"phong":e.locPhongTheta=r.getUniformLocation(l.program,e.theta),r.uniform1f(e.locPhongTheta,e.theta)}e.locFlatShading=r.getUniformLocation(l.program,e.flatShadingUniform),r.uniform1f(e.locFlatShading,e.flatShading?1:0),e.loc=r.getUniformLocation(l.program,e.name),r[e.dataType](e.loc,e.value)})),l.locColor=r.getUniformLocation(l.program,"color"),r.uniform3f(l.locColor,...HexToRGB(a.color)),l.locColorMix=r.getUniformLocation(l.program,"colorMix"),r.uniform1f(l.locColorMix,a.colorMix),l.locIsSprite=r.getUniformLocation(l.program,"isSprite"),r.uniform1f(l.locIsSprite,a.isSprite),l.locIsLight=r.getUniformLocation(l.program,"isLight"),r.uniform1f(l.locIsLight,a.isLight),l.locAlpha=r.getUniformLocation(l.program,"alpha"),r.uniform1f(l.locAlpha,a.alpha),l.locPointLights=r.getUniformLocation(l.program,"pointLightPos[0]"),l.locPointLightCols=r.getUniformLocation(l.program,"pointLightCol[0]"),l.locPointLightCount=r.getUniformLocation(l.program,"pointLightCount"),r.uniform1i(l.locPointLightCount,0),l.locResolution=r.getUniformLocation(l.program,"resolution"),r.uniform2f(l.locResolution,e.width,e.height),l.locEquirectangular=r.getUniformLocation(l.program,"equirectangular"),r.uniform1f(l.locEquirectangular,a.equirectangular?1:0),l.locT=r.getUniformLocation(l.program,"t"),r.uniform1f(l.locT,0),l.locAmbientLight=r.getUniformLocation(l.program,"ambientLight"),r.uniform1f(l.locAmbientLight,e.ambientLight),l.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,l.texture),l.locTexture=r.getUniformLocation(l.program,"baseTexture"),s){let e;switch(l.iURL=s,(e=s.split("."))[e.length-1].toLowerCase()){case"mp4":case"webm":case"avi":case"mkv":case"ogv":a.textureMode="video",i&&(cacheItem=cache.textures.filter((e=>e.url==l.iURL))).length?(console.log("found video in cache... using it"),l.resource=cacheItem[0].resource,l.texture=cacheItem[0].texture):(l.resource=document.createElement("video"),l.resource.muted=!0,l.resource.addEventListener("canplay",(()=>{l.resource.playbackRate=l.resource.defaultPlaybackRate=a.playbackSpeed})),l.resource.loop=!0,a.muted||audioConsent||(audioConsent=!0,GenericPopup("play audio OK?",!0,(()=>{l.resource.muted=!1,l.resource.currentTime=0,l.resource.play()}))),l.resource.playbackRate=l.resource.defaultPlaybackRate=a.playbackSpeed,l.resource.oncanplay=async()=>{l.resource.play()},cache.textures.push({url:s,resource:l.resource,texture:l.texture}),await fetch(s).then((e=>e.blob())).then((e=>{l.resource.src=URL.createObjectURL(e)})));break;default:a.textureMode="image";var f=new Image;r.activeTexture(r.TEXTURE0),cache.textures.push({url:s,resource:f,texture:l.texture}),f.onload=()=>{BindImage(r,f,l.texture,a.textureMode,-1,s)},await fetch(s).then((e=>e.blob())).then((e=>{f.src=URL.createObjectURL(e)}))}}r.useProgram(l.program),r.uniform1i(l.locTexture,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,l.texture),l.locCamPos=r.getUniformLocation(l.program,"camPos"),l.locCamOri=r.getUniformLocation(l.program,"camOri"),l.locGeoPos=r.getUniformLocation(l.program,"geoPos"),l.locGeoOri=r.getUniformLocation(l.program,"geoOri"),l.locFov=r.getUniformLocation(l.program,"fov"),l.locRenderNormals=r.getUniformLocation(l.program,"renderNormals"),r.uniform3f(l.locCamPos,e.x,e.y,e.z),r.uniform3f(l.locCamOri,e.roll,e.pitch,e.yaw),r.uniform3f(l.locGeoPos,e.x,e.y,e.z),r.uniform3f(l.locGeoOri,a.roll,a.pitch,a.yaw),r.uniform1f(l.locFov,e.fov),r.uniform1f(l.locRenderNormals,0)}}else{var p=r.getProgramInfoLog(l.program),m=r.getShaderInfoLog(c),u=r.getShaderInfoLog(h);console.error(`bad shader :( ${p}`),console.error(`vShader info : ${m}`),console.error(`fShader info : ${u}`)}},o},IsPolyhedron=e=>{var a;switch(e){case"tetrahedron":case"cube":case"octahedron":case"dodecahedron":case"icosahedron":case"tetrahedron":case"dynamic":a=!0;break;default:a=!1}return a},GeometryFromRaw=async(e,a,r,t,o,n,i=!1,l="")=>{var s,c,h,f,p,m=new Float32Array,u=new Float32Array,d=e,g=new Float32Array,y=`${l}_${t}`,v=IsPolyhedron(l);if("obj"===l)p=await subbed(0,1,o,d,a,y);else p=await subbed(t+(v?1:0),1,o,d,a,y);for(p.map((e=>{e.verts.map((e=>{e[0]*=r,e[1]*=r,e[2]*=r})),i?(m=[...m,e.verts[0],e.verts[1],e.verts[2],e.verts[2],e.verts[3],e.verts[0]],void 0!==e.uvs&&e.uvs.length&&(u=[...u,e.uvs[0],e.uvs[1],e.uvs[2],e.uvs[2],e.uvs[3],e.uvs[0]])):(m=[...m,...e.verts],void 0!==e.uvs&&e.uvs.length&&(u=[...u,...e.uvs]))})),c=0;c<m.length;c++){var R;h=[m[3*(s=c/3|0)+0],m[3*s+1],m[3*s+2]],c%3||(R=Normal(h,v),n||(R[3]=R[0]+(R[0]-R[3]),R[4]=R[1]+(R[1]-R[4]),R[5]=R[2]+(R[2]-R[5]))),f=n?m.length-c-1:c,g=[...g,{position:m[f],normal:[...m[f],m[f][0]+(R[3]-R[0]),m[f][1]+(R[4]-R[1]),m[f][2]+(R[5]-R[2])],texCoord:u[f]}]}return{geometry:g}},subbed=async(e,a,r,t,o,n="")=>{var i,l,s,c,h,f,p,m,u,d,g,y,v,R,A,b,E,x,_,F,M,T,I,w,P,C,S,L,B,U,N,k,O,D,z,V,G,Y,H,X,W,K,q,j,$,Q,Z,J,ee,ae,re,te,oe,ne,ie,le,se,ce,he,fe,pe,me,ue,de,ge,ye,ve=!1;if(!ve)for(var Re=e;Re--;)i=t,l=o,t=new Float32Array,o=new Float32Array,i.map(((e,a)=>{switch(p=e[s=0][0],m=e[s][1],u=e[s][2],l.length&&l[a].length>s&&(ye=l[a],P=ye[s][0],C=ye[s][1]),d=e[s=1][0],g=e[s][1],y=e[s][2],l.length&&l[a].length>s&&(S=ye[s][0],L=ye[s][1]),v=e[s=2][0],R=e[s][1],A=e[s][2],l.length&&l[a].length>s&&(B=ye[s][0],U=ye[s][1]),e.length>3&&(b=e[s=3][0],E=e[s][1],x=e[s][2],l.length&&l[a].length>s&&(N=ye[s][0],k=ye[s][1]),e.length>4&&(_=e[s=4][0],F=e[s][1],M=e[s][2],l.length&&l[a].length>s&&(O=ye[s][0],D=ye[s][1]),e.length>5&&(T=e[s=5][0],I=e[s][1],w=e[s][2],l.length&&l[a].length>s&&(z=ye[s][0],V=ye[s][1])))),G=(p+d)/2,Y=(m+g)/2,H=(u+y)/2,X=(d+v)/2,W=(g+R)/2,K=(y+A)/2,void 0!==P&&(ee=(P+S)/2,ae=(C+L)/2,re=(S+B)/2,te=(L+U)/2),me=new Float32Array,ue=new Float32Array,e.length){case 3:q=(v+p)/2,j=(R+m)/2,$=(A+u)/2,void 0!==P&&(oe=(B+P)/2,ne=(U+C)/2,c=P,h=C,ue=[...ue,[c,h]],c=ee,h=ae,ue=[...ue,[c,h]],c=oe,h=ne,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=ee,h=ae,ue=[...ue,[c,h]],c=S,h=L,ue=[...ue,[c,h]],c=re,h=te,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=oe,h=ne,ue=[...ue,[c,h]],c=re,h=te,ue=[...ue,[c,h]],c=B,h=U,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=ee,h=ae,ue=[...ue,[c,h]],c=re,h=te,ue=[...ue,[c,h]],c=oe,h=ne,ue=[...ue,[c,h]],o=[...o,ue]),c=p,h=m,f=u,me=[...me,[c,h,f]],c=G,h=Y,f=H,me=[...me,[c,h,f]],c=q,h=j,f=$,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=G,h=Y,f=H,me=[...me,[c,h,f]],c=d,h=g,f=y,me=[...me,[c,h,f]],c=X,h=W,f=K,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=q,h=j,f=$,me=[...me,[c,h,f]],c=X,h=W,f=K,me=[...me,[c,h,f]],c=v,h=R,f=A,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=G,h=Y,f=H,me=[...me,[c,h,f]],c=X,h=W,f=K,me=[...me,[c,h,f]],c=q,h=j,f=$,me=[...me,[c,h,f]],t=[...t,me];break;case 4:q=(v+b)/2,j=(R+E)/2,$=(A+x)/2,Q=(b+p)/2,Z=(E+m)/2,J=(x+u)/2,void 0!==P&&(oe=(B+N)/2,ne=(U+k)/2,ie=(N+P)/2,le=(k+C)/2,de=(P+S+B+N)/4,ge=(C+L+U+k)/4,c=P,h=C,ue=[...ue,[c,h]],c=ee,h=ae,ue=[...ue,[c,h]],c=de,h=ge,ue=[...ue,[c,h]],c=ie,h=le,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=ee,h=ae,ue=[...ue,[c,h]],c=S,h=L,ue=[...ue,[c,h]],c=re,h=te,ue=[...ue,[c,h]],c=de,h=ge,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=de,h=ge,ue=[...ue,[c,h]],c=re,h=te,ue=[...ue,[c,h]],c=B,h=U,ue=[...ue,[c,h]],c=oe,h=ne,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=ie,h=le,ue=[...ue,[c,h]],c=de,h=ge,ue=[...ue,[c,h]],c=oe,h=ne,ue=[...ue,[c,h]],c=N,h=k,ue=[...ue,[c,h]],o=[...o,ue]),se=(p+d+v+b)/4,ce=(m+g+R+E)/4,he=(u+y+A+x)/4,c=p,h=m,f=u,me=[...me,[c,h,f]],c=G,h=Y,f=H,me=[...me,[c,h,f]],c=se,h=ce,f=he,me=[...me,[c,h,f]],c=Q,h=Z,f=J,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=G,h=Y,f=H,me=[...me,[c,h,f]],c=d,h=g,f=y,me=[...me,[c,h,f]],c=X,h=W,f=K,me=[...me,[c,h,f]],c=se,h=ce,f=he,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=se,h=ce,f=he,me=[...me,[c,h,f]],c=X,h=W,f=K,me=[...me,[c,h,f]],c=v,h=R,f=A,me=[...me,[c,h,f]],c=q,h=j,f=$,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=Q,h=Z,f=J,me=[...me,[c,h,f]],c=se,h=ce,f=he,me=[...me,[c,h,f]],c=q,h=j,f=$,me=[...me,[c,h,f]],c=b,h=E,f=x,me=[...me,[c,h,f]],t=[...t,me];break;case 5:se=(p+d+v+b+_)/5,ce=(m+g+R+E+F)/5,he=(u+y+A+x+M)/5,void 0!==P&&(de=(P+S+B+N+O)/5,ge=(C+L+U+k+D)/5,oe=(B+N)/2,ne=(U+k)/2,ie=(N+O)/2,le=(k+D)/2,(O+P)/2,(D+C)/2,c=P,h=C,ue=[...ue,[c,h]],c=S,h=L,ue=[...ue,[c,h]],c=de,h=ge,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=S,h=L,ue=[...ue,[c,h]],c=B,h=U,ue=[...ue,[c,h]],c=de,h=ge,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=B,h=U,ue=[...ue,[c,h]],c=N,h=k,ue=[...ue,[c,h]],c=de,h=ge,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=N,h=k,ue=[...ue,[c,h]],c=O,h=D,ue=[...ue,[c,h]],c=de,h=ge,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=O,h=D,ue=[...ue,[c,h]],c=P,h=C,ue=[...ue,[c,h]],c=de,h=ge,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array),q=(v+b)/2,j=(R+E)/2,$=(A+x)/2,Q=(b+_)/2,Z=(E+F)/2,J=(x+M)/2,(_+p)/2,(F+m)/2,(M+u)/2,c=p,h=m,f=u,me=[...me,[c,h,f]],c=d,h=g,f=y,me=[...me,[c,h,f]],c=se,h=ce,f=he,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=d,h=g,f=y,me=[...me,[c,h,f]],c=v,h=R,f=A,me=[...me,[c,h,f]],c=se,h=ce,f=he,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=v,h=R,f=A,me=[...me,[c,h,f]],c=b,h=E,f=x,me=[...me,[c,h,f]],c=se,h=ce,f=he,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=b,h=E,f=x,me=[...me,[c,h,f]],c=_,h=F,f=M,me=[...me,[c,h,f]],c=se,h=ce,f=he,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=_,h=F,f=M,me=[...me,[c,h,f]],c=p,h=m,f=u,me=[...me,[c,h,f]],c=se,h=ce,f=he,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array;break;case 6:se=(p+d+v+b+_)/5,ce=(m+g+R+E+F)/5,he=(u+y+A+x+M)/5,void 0!==P&&(de=(P+S+B+N+O+z)/6,ge=(C+L+U+k+D+V)/6,oe=(B+N)/2,ne=(U+k)/2,ie=(N+O)/2,le=(k+D)/2,(O+z)/2,(D+V)/2,(z+P)/2,(V+C)/2,c=P,h=C,ue=[...ue,[c,h]],c=S,h=L,ue=[...ue,[c,h]],c=de,h=ge,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=S,h=L,ue=[...ue,[c,h]],c=B,h=U,ue=[...ue,[c,h]],c=de,h=ge,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=B,h=U,ue=[...ue,[c,h]],c=N,h=k,ue=[...ue,[c,h]],c=de,h=ge,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=N,h=k,ue=[...ue,[c,h]],c=O,h=D,ue=[...ue,[c,h]],c=de,h=ge,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=O,h=D,ue=[...ue,[c,h]],c=z,h=V,ue=[...ue,[c,h]],c=de,h=ge,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array,c=z,h=V,ue=[...ue,[c,h]],c=P,h=C,ue=[...ue,[c,h]],c=de,h=ge,ue=[...ue,[c,h]],o=[...o,ue],ue=new Float32Array),q=(v+b)/2,j=(R+E)/2,$=(A+x)/2,Q=(b+_)/2,Z=(E+F)/2,J=(x+M)/2,(_+T)/2,(F+I)/2,(M+w)/2,(T+p)/2,(I+m)/2,(w+u)/2,c=p,h=m,f=u,me=[...me,[c,h,f]],c=d,h=g,f=y,me=[...me,[c,h,f]],c=se,h=ce,f=he,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=d,h=g,f=y,me=[...me,[c,h,f]],c=v,h=R,f=A,me=[...me,[c,h,f]],c=se,h=ce,f=he,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=v,h=R,f=A,me=[...me,[c,h,f]],c=b,h=E,f=x,me=[...me,[c,h,f]],c=se,h=ce,f=he,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=b,h=E,f=x,me=[...me,[c,h,f]],c=_,h=F,f=M,me=[...me,[c,h,f]],c=se,h=ce,f=he,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=_,h=F,f=M,me=[...me,[c,h,f]],c=T,h=I,f=w,me=[...me,[c,h,f]],c=se,h=ce,f=he,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array,c=T,h=I,f=w,me=[...me,[c,h,f]],c=p,h=m,f=u,me=[...me,[c,h,f]],c=se,h=ce,f=he,me=[...me,[c,h,f]],t=[...t,me],me=new Float32Array}}));if(r){var Ae;fe=r,pe=1-r;for(Re=2;Re--;)(Re?t:o).map((e=>{e.map((e=>{c=e[0],h=e[1],f=Re?e[2]:0,Ae=Math.hypot(c,h,f),c/=Ae,h/=Ae,f/=Ae,e[0]=c*=fe+Ae*pe,e[1]=h*=fe+Ae*pe,Re&&(e[2]=f*=fe+Ae*pe)}))}))}return t.map(((e,a)=>({verts:e,uvs:o[a]})))},Camera=(e=0,a=0,r=0,t=0,o=0,n=0)=>({x:e,y:a,z:r,roll:t,pitch:o,yaw:n}),GeoSphere=(e,a,r,t,o)=>{let n,i,l,s,c,h,f,p,m,u,d,g,y,v,R=Array(t).fill().map((e=>(n=Rn()-.5,i=Rn()-.5,l=Rn()-.5,[n,i,l])));for(let e=99;e--;)R.map(((e,a)=>{n=e[0],i=e[1],l=e[2],R.map(((e,r)=>{r!=a&&(f=e[0],p=e[1],m=e[2],d=1+(Math.hypot(n-f,i-p,l-m)*(3+t/70)*3)**3,n+=9*(n-f)/d,i+=9*(i-p)/d,l+=9*(l-m)/d)})),d=Math.hypot(n,i,l),e[0]=n/d,e[1]=i/d,e[2]=l/d}));return u=6e6,R.map(((e,a)=>{s=e[0],c=e[1],h=e[2],R.map(((e,r)=>{f=e[0],p=e[1],m=e[2],a!=r&&(d=Math.hypot(g=s-f,y=c-p,v=h-m),d<u&&(u=d))}))})),g=new Float32Array,R.map(((e,a)=>{s=e[0],c=e[1],h=e[2],R.map(((e,r)=>{f=e[0],p=e[1],m=e[2],a!=r&&(d=Math.hypot(s-f,c-p,h-m),d<2*u&&(g.filter((e=>e[0]==f&&e[1]==p&&e[2]==m&&e[3]==s&&e[4]==c&&e[5]==h)).length||(g=[...g,[s*o,c*o,h*o,f*o,p*o,m*o]])))}))})),R.map((t=>{t[0]*=o/1.3333,t[1]*=o/1.3333,t[2]*=o/1.3333,t[0]+=e,t[1]+=a,t[2]+=r})),[e,a,r,o,R,g]},Cylinder=async(e=1,a=0,r=0,t=!1,o,n,i)=>{for(var l,s,c,h,f,p,m,u,d,g,y,v,R,A,b,E,x,_,F,M,T=new Float32Array,I=new Float32Array,w=0;w<n;w++)for(var P=w-.5,L=0;L<i;L++){l=S(2*Math.PI/i*L),s=1/n*P-.5,c=C(2*Math.PI/i*L),h=S(2*Math.PI/i*(L+1)),f=1/n*P-.5,p=C(2*Math.PI/i*(L+1)),m=S(2*Math.PI/i*(L+1)),u=1/n*(P+1)-.5,d=C(2*Math.PI/i*(L+1)),g=S(2*Math.PI/i*L),y=1/n*(P+1)-.5,v=C(2*Math.PI/i*L);var B=Math.atan2(l,c),U=Math.atan2(h,p),N=Math.atan2(m,d),k=Math.atan2(g,v);Math.abs(B-U)>Math.PI&&(B-=2*Math.PI,k-=2*Math.PI),R=(B+Math.PI)/Math.PI/2,A=s+.5,b=(U+Math.PI)/Math.PI/2,E=f+.5,x=(N+Math.PI)/Math.PI/2,_=u+.5,F=(k+Math.PI)/Math.PI/2,M=y+.5,T=[...T,[[l,s,c],[h,f,p],[m,u,d],[g,y,v]]],I=[...I,[[R,A],[b,E],[x,_],[F,M]]]}return await GeometryFromRaw(T,I,e/1.2,a,r,t,!0,o)},Torus=async(e=1,a=0,r=0,t=!1,o,n,i)=>{for(var l,s,c,h,f,p,m,u,d,g,y,v,R,A,b,E,x,_,F,M,T,I,w,P,L=new Float32Array,B=new Float32Array,U=4*n,N=.5,k=1.25,O=0;O<U;O++)for(var D=O+.5,z=0;z<i;z++){l=S(w=2*Math.PI/i*z)*N+k,s=C(w)*N,0,w=Math.atan2(l,0)+2*Math.PI/U*D+Math.PI/2,P=Math.hypot(l,0),c=S(w)*P,h=s,f=C(w)*P,l=S(w=2*Math.PI/i*(z+1))*N+k,s=C(w)*N,w=Math.atan2(l,0)+2*Math.PI/U*D+Math.PI/2,P=Math.hypot(l,0),p=S(w)*P,m=s,u=C(w)*P,l=S(w=2*Math.PI/i*(z+1))*N+k,s=C(w)*N,w=Math.atan2(l,0)+2*Math.PI/U*(D+1)+Math.PI/2,P=Math.hypot(l,0),d=S(w)*P,g=s,y=C(w)*P,l=S(w=2*Math.PI/i*z)*N+k,s=C(w)*N,w=Math.atan2(l,0)+2*Math.PI/U*(D+1)+Math.PI/2,P=Math.hypot(l,0),v=S(w)*P,R=s,A=C(w)*P;var V=Math.atan2(c,f),G=Math.atan2(p,u),Y=Math.atan2(d,y),H=Math.atan2(v,A);Math.abs(V-Y)>Math.PI&&(Y+=2*Math.PI,H+=2*Math.PI),b=(V+Math.PI)/Math.PI/2,E=h+.5,x=(G+Math.PI)/Math.PI/2,_=m+.5,F=(Y+Math.PI)/Math.PI/2,M=g+.5,T=(H+Math.PI)/Math.PI/2,I=R+.5,L=[...L,[[c,h,f],[p,m,u],[d,g,y],[v,R,A]]],B=[...B,[[b,E],[x,_],[F,M],[T,I]]]}return await GeometryFromRaw(L,B,e/1.2,a,r,t,!0,o)},TorusKnot=async(e=1,a=0,r=0,t=!1,o,n,i)=>{var l,s,c,h,f,p,m,u,d,g,y,v,R,A,b,E,x,_,F,M,T,I,w,P,L,B=new Float32Array,U=new Float32Array,N=8*n;i/=1;for(var k,O,D,z,V,G,Y,H=.75,X=0;X<2*N;X++)for(var W=0;W<i;W++){var K=X+.5,q=X+1.5,j=X+2.5;h=3+S(k=2*Math.PI*1.5*1/N*K)/1,f=G=2*C(k),m=3+S(O=2*Math.PI*1.5*1/N*q)/1,u=Y=2*C(O),g=3+S(D=2*Math.PI*1.5*1/N*j)/1,y=2*C(D),z=(Math.acos((u-f)/(Math.hypot(m-h,u-f)+1e-4))-Math.PI/2)/2,V=(Math.acos((y-u)/(Math.hypot(g-m,y-u)+1e-4))-Math.PI/2)/2;var $=3+S(k)/1;l=S(P=2*Math.PI/i*W)*H+$,s=C(P)*H+G,c=0,P=Math.atan2(s,c)+z,L=Math.hypot(s,c),s=S(P)*L,c=C(P)*L,P=Math.atan2(l,c)+2*Math.PI/N*K+Math.PI/2,L=Math.hypot(l,c),h=S(P)*L,f=s,p=C(P)*L,l=S(P=2*Math.PI/i*(W+1))*H+$,s=C(P)*H+G,c=0,P=Math.atan2(s,c)+z,L=Math.hypot(s,c),s=S(P)*L,c=C(P)*L,P=Math.atan2(l,c)+2*Math.PI/N*K+Math.PI/2,L=Math.hypot(l,c),m=S(P)*L,u=s,d=C(P)*L,$=3+S(O)/1,l=S(P=2*Math.PI/i*(W+1))*H+$,s=C(P)*H+Y,c=0,P=Math.atan2(s,c)+V,L=Math.hypot(s,c),s=S(P)*L,c=C(P)*L,P=Math.atan2(l,c)+2*Math.PI/N*q+Math.PI/2,L=Math.hypot(l,c),g=S(P)*L,y=s,v=C(P)*L,l=S(P=2*Math.PI/i*W)*H+$,s=C(P)*H+Y,c=0,P=Math.atan2(s,c)+V,L=Math.hypot(s,c),s=S(P)*L,c=C(P)*L,P=Math.atan2(l,c)+2*Math.PI/N*q+Math.PI/2,L=Math.hypot(l,c),R=S(P)*L,A=s,b=C(P)*L;var Q=Math.atan2(h,p),Z=Math.atan2(m,d),J=Math.atan2(g,v),ee=Math.atan2(R,b);Math.abs(Q-J)>Math.PI&&(J+=2*Math.PI,ee+=2*Math.PI),E=(Q+Math.PI)/Math.PI/2,x=f+.5,_=(Z+Math.PI)/Math.PI/2,F=u+.5,M=(J+Math.PI)/Math.PI/2,T=y+.5,I=(ee+Math.PI)/Math.PI/2,w=A+.5,B=[...B,[[h,f,p],[m,u,d],[g,y,v],[R,A,b]]],U=[...U,[[E,x],[_,F],[M,T],[I,w]]]}return await GeometryFromRaw(B,U,e/1.2,a,r,t,!0,o)},Tetrahedron=async(e=1,a=0,r=0,t=!1,o)=>{new Float32Array;var n,i,l,s,c,h,f,p,m,u,d,g,y,v=new Float32Array;g=new Float32Array;let R=1/1.4142/1.25;for(u=3;u--;)n=1*S(s=2*Math.PI/3*u)/1.25,i=1*C(s)/1.25,l=R,g=[...g,[n,i,l]];for(v=[...v,g],d=3;d--;)g=new Float32Array,n=0,i=0,l=-R,g=[...g,[n,i,l]],n=1*S(s=2*Math.PI/3*d)/1.25,i=1*C(s)/1.25,l=R,g=[...g,[n,i,l]],n=1*S(s=2*Math.PI/3*(d+1))/1.25,i=1*C(s)/1.25,l=R,g=[...g,[n,i,l]],v=[...v,g];f=p=m=y=0,v.map((e=>{e.map((e=>{f+=e[0],p+=e[1],m+=e[2],y++}))})),f/=y,p/=y,m/=y,v.map((e=>{e.map((e=>{e[0]-=f,e[1]-=p,e[2]-=m}))}));var A=v,b=new Float32Array;for(u=0;u<A.length;u++){g=new Float32Array;for(var E=A[u].length;E--;){switch(E){case 0:c=0,h=0;break;case 1:c=1,h=0;break;case 2:c=1,h=1;break;case 3:c=0,h=.5;break;case 4:c=0,h=1}g=[...g,[c,h]]}b=[...b,g]}return await GeometryFromRaw(A,b,e,a,r,t,!1,o)},Octahedron=async(e=1,a=0,r=0,t=!1,o)=>{new Float32Array;var n,i,l,s,c,h,f,p,m,u=new Float32Array;for(p=8;p--;)m=new Float32Array,n=0,i=0,l=.8*(p<4?-1:1),m=[...m,[n,i,l]],n=1*S(s=2*Math.PI/4*p)/1.25,i=1*C(s)/1.25,l=0,m=[...m,[n,i,l]],n=1*S(s=2*Math.PI/4*(p+1))/1.25,i=1*C(s)/1.25,l=0,m=[...m,[n,i,l]],u=[...u,m];var d=u,g=new Float32Array;for(f=0;f<d.length;f++){m=new Float32Array;for(var y=d[f].length;y--;){switch(y){case 0:c=0,h=0;break;case 1:c=1,h=0;break;case 2:c=1,h=1;break;case 3:c=0,h=.5;break;case 4:c=0,h=1}m=[...m,[c,h]]}g=[...g,m]}return await GeometryFromRaw(d,g,e,a,r,t,!1,o)},Icosahedron=async(e=1,a=0,r=0,t=!1,o)=>{new Float32Array;var n,i,l,s,c,h,f,p,m,u,d,g,y,v,R,A=new Float32Array;for(p=[[-(f=.5+5**.5/2),-1,0],[f,-1,0],[f,1,0],[-f,1,0]],h=3;h--;A=[...A,i])for(i=[],n=4;n--;)i=[...i,[p[n][h],p[n][(h+1)%3],p[n][(h+2)%3]]];A.map((e=>{e.map((e=>{e[0]*=1/2.25,e[1]*=1/2.25,e[2]*=1/2.25}))})),m=JSON.parse(JSON.stringify(A)),c=[],p=new Float32Array,[[[0,3],[1,0],[2,2]],[[0,3],[1,0],[1,3]],[[0,3],[2,3],[1,3]],[[0,2],[2,1],[1,0]],[[0,2],[1,3],[1,0]],[[0,2],[1,3],[2,0]],[[0,3],[2,2],[0,0]],[[1,0],[2,2],[2,1]],[[1,1],[2,2],[2,1]],[[1,1],[2,2],[0,0]],[[1,1],[2,1],[0,1]],[[0,2],[2,1],[0,1]],[[2,0],[1,2],[2,3]],[[0,0],[0,3],[2,3]],[[1,3],[2,0],[2,3]],[[2,3],[0,0],[1,2]],[[1,2],[2,0],[0,1]],[[0,0],[1,2],[1,1]],[[0,1],[1,2],[1,1]],[[0,2],[2,0],[0,1]]].map((e=>{u=e[0][0],d=e[1][0],g=e[2][0],y=e[0][1],v=e[1][1],R=e[2][1],p=[...p,[m[u][y],m[d][v],m[g][R]]]}));var b=c=[...c,...p],E=new Float32Array;for(n=0;n<b.length;n++){p=new Float32Array;for(var x=b[n].length;x--;){switch(x){case 0:l=0,s=0;break;case 1:l=1,s=0;break;case 2:l=1,s=1;break;case 3:l=0,s=.5;break;case 4:l=0,s=1}p=[...p,[l,s]]}E=[...E,p]}return await GeometryFromRaw(b,E,e,a,r,t,!1,o)},Dodecahedron=async(e=1,a=0,r=0,t=!1,o)=>{var n,i,l,s,c,h,f,p,m,u,d=new Float32Array,g=new Float32Array;let y=-6e6;for(u=5;u--;)n=S(h=2*Math.PI/5*u+Math.PI/5),i=C(h),l=0,i>y&&(y=i),g=[...g,[n,i,l]];g=g.map((e=>(n=e[0],i=e[1]-=y,l=e[2],R(n,i,l,{x:0,y:0,z:0,roll:0,pitch:.553573,yaw:0})))),(c=structuredClone(g)).map((e=>{e[1]*=-1})),d=[...d,g,c],y=-6e6,d.map((e=>{e.map((e=>{n=e[0],i=e[1],(l=e[2])>y&&(y=l)}))})),s=Math.hypot(d[0][0][0]-d[0][1][0],d[0][0][1]-d[0][1][1],d[0][0][2]-d[0][1][2]),d.map((e=>{e.map((e=>{e[2]-=y+s/2}))})),(c=structuredClone(d)).map((e=>{e.map((e=>{e[2]*=-1}))})),d=[...d,...c],(c=structuredClone(d)).map((e=>{e.map((e=>{n=e[0],i=e[1],l=e[2],f=R(n,i,l,{x:0,y:0,z:0,roll:0,pitch:0,yaw:Math.PI/2}),f=R(f[0],f[1],f[2],{x:0,y:0,z:0,roll:0,pitch:Math.PI/2,yaw:0}),e[0]=f[0],e[1]=f[1],e[2]=f[2]}))})),(v=structuredClone(d)).map((e=>{e.map((e=>{n=e[0],i=e[1],l=e[2],f=R(n,i,l,{x:0,y:0,z:0,roll:0,pitch:0,yaw:Math.PI/2}),f=R(f[0],f[1],f[2],{x:0,y:0,z:0,roll:Math.PI/2,pitch:0,yaw:0}),e[0]=f[0],e[1]=f[1],e[2]=f[2]}))}));var v=d=[...d,...c,...v],A=new Float32Array;for(u=0;u<v.length;u++){g=new Float32Array;for(var b=v[u].length;b--;){switch(b){case 0:p=0,m=0;break;case 1:p=1,m=0;break;case 2:p=1,m=1;break;case 3:p=0,m=.5;break;case 4:p=0,m=1}g=[...g,[p,m]]}A=[...A,g]}return await GeometryFromRaw(v,A,e/Math.max(1,2-r),a,r,t,!1,o)},Cube=async(e=1,a=0,r=0,t=!1,o)=>{var n,i,l,s,c,h,f,p,m=Math.PI,u=(new Float32Array,new Float32Array);for(c=6;c--;u=[...u,l])for(l=[],h=4;h--;)l=[...l,[(i=[S(n=2*m/4*h+m/4),C(n),2**.5/2])[c%3]*(s=c<3?1:-1),i[(c+1)%3]*s,i[(c+2)%3]*s]];var d=new Float32Array;for(c=0;c<u.length;c++){i=new Float32Array;for(var g=u[c].length;g--;){switch(g){case 0:f=0,p=0;break;case 1:f=1,p=0;break;case 2:f=1,p=1;break;case 3:f=0,p=1}i=[...i,[f,p]]}d=[...d,i]}return await GeometryFromRaw(u,d,e/1.2,a,r,t,!0,o)},Rectangle=async(e=1,a=0,r=0,t=!1,o)=>{Math.PI,new Float32Array;var n=new Float32Array;n=[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]]];return await GeometryFromRaw(n,[[[0,0],[1,0],[1,1],[0,1]]],e/1.5,Math.max("sprite"==o?1:2,a),r,t,!0,o)},IsPowerOf2=(e,a=0)=>!(a>300)&&(2==e||IsPowerOf2(e/2,a+1)),Normal=(e,a=!1,r=0,t=0,o=0)=>{var n,i,l=0,s=0,c=0;e.map((e=>{l+=e[0],s+=e[1],c+=e[2]})),l/=e.length,s/=e.length,c/=e.length;var h=e[2][0]-e[1][0],f=e[2][1]-e[1][1],p=e[2][2]-e[1][2],m=e[1][0]-e[0][0],u=e[1][1]-e[0][1],d=e[1][2]-e[0][2];n=[f*d-p*u,p*m-h*d,h*u-f*m],i=Math.hypot(...n)+1e-4;n=n.map((e=>e/i*1));var g=l,y=s,v=c,R=1;if(a){var A=Math.hypot(g-r,y-t,v-o);R=Math.hypot(r-(l+n[0]/99),t-(s+n[1]/99),o-(c+n[2]/99))>A?-1:1}return[g,y,v,l+(n[0]*=R),s+(n[1]*=R),c+(n[2]*=R)]},AnimationLoop=(e,a)=>{const r=()=>{if(e.ready&&void 0!==window[a]&&window[a](),e.spriteQueue.length){var t,o=new Float32Array;e.spriteQueue.map(((a,r)=>{var n=a.x+e.x,i=a.y+e.y,l=a.z+e.z;t=R(n,i,l,{roll:e.roll,pitch:e.pitch,yaw:e.yaw},!1);var s=e.z/1e3*Math.pow(5,Math.log(e.fov)/1.609438);o=[...o,{idx:r,z:s+t[2]}]})),o.sort(((e,a)=>a.z-e.z)),e.ctx.blendFunc(e.ctx.SRC_ALPHA,e.ctx.ONE),e.ctx.enable(e.ctx.BLEND),e.spriteQueue.map((async(a,r)=>{var t=e.spriteQueue[o[r].idx];t.disableDepthTest&&e.ctx.disable(e.ctx.DEPTH_TEST),await e.Draw(t,!0),t.disableDepthTest&&e.ctx.enable(e.ctx.DEPTH_TEST)})),e.ctx.blendFunc(e.ctx.ONE,e.ctx.ZERO),e.ctx.disable(e.ctx.BLEND)}e.t+=1/60,requestAnimationFrame(r),e.spriteQueue=new Float32Array};window.addEventListener("load",(()=>{e.ready=!0,r()}))},RGBToHSV=(e,a,r)=>HSVFromRGB(e,a,r),HSVFromRGB=(e,a,r)=>{let t=e/255,o=a/255,n=r/255,i=Math.min(t,o,n),l=Math.max(t,o,n),s=l,c=l-i,h=l?c/l:0,f=Math.min(e,a,r),p=Math.max(e,a,r),m=0;for(c&&(e>=a&&e>=r&&(m=(a-r)/(p-f)),a>=e&&a>=r&&(m=2+(r-e)/(p-f)),r>=a&&r>=e&&(m=4+(e-a)/(p-f))),m*=60;m<0;)m+=360;for(;m>=360;)m-=360;return[m,h,s]},HSVToHex=(e,a,r)=>HexFromHSV(e,a,r),HexFromHSV=(e,a,r)=>{let t=RGBFromHSV(e,a,r);return RGBToHex(...t)},HSVToRGB=(e,a,r)=>RGBFromHSV(e,a,r),RGBFromHSV=(e,a,r)=>{for(;e<0;)e+=360;for(;e>=360;)e-=360;let t,o,n,i=r*a,l=i*(1-Math.abs(e/60%2-1)),s=r-i;return e>=0&&e<60&&(t=i,o=l,n=0),e>=60&&e<120&&(t=l,o=i,n=0),e>=120&&e<180&&(t=0,o=i,n=l),e>=180&&e<240&&(t=0,o=l,n=i),e>=240&&e<300&&(t=l,o=0,n=i),e>=300&&e<360&&(t=i,o=0,n=l),[255*(t+s),255*(o+s),255*(n+s)]},HexFromRGB=(e,a,r)=>RGBToHex(e,a,r),RGBToHex=(e,a,r)=>{let t="0123456789abcdef",o="";return o+=t[e/16|0],o+=t[e-16*(e/16|0)|0],o+=t[a/16|0],o+=t[a-16*(a/16|0)|0],o+=t[r/16|0],o+=t[r-16*(r/16|0)|0],Number("0x"+o)},RGBFromHex=e=>HexToRGB(e),HexToRGB=e=>[e/256**3-(e/256**3|0),e/65536-(e/65536|0),e/256-(e/256|0)],getParams=e=>{var a=[];["COPY_READ_BUFFER_BINDING","COPY_WRITE_BUFFER_BINDING","DRAW_BUFFERi","DRAW_FRAMEBUFFER_BINDING","FRAGMENT_SHADER_DERIVATIVE_HINT","MAX_3D_TEXTURE_SIZE","MAX_ARRAY_TEXTURE_LAYERS","MAX_CLIENT_WAIT_TIMEOUT_WEBGL","MAX_COLOR_ATTACHMENTS","MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS","MAX_COMBINED_UNIFORM_BLOCKS","MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS","MAX_DRAW_BUFFERS","MAX_ELEMENT_INDEX","MAX_ELEMENTS_INDICES","MAX_ELEMENTS_VERTICES","MAX_FRAGMENT_INPUT_COMPONENTS","MAX_FRAGMENT_UNIFORM_BLOCKS","MAX_FRAGMENT_UNIFORM_COMPONENTS","MAX_PROGRAM_TEXEL_OFFSET","MAX_SAMPLES","MAX_SERVER_WAIT_TIMEOUT","MAX_TEXTURE_LOD_BIAS","MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS","MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS","MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS","MAX_UNIFORM_BLOCK_SIZE","MAX_UNIFORM_BUFFER_BINDINGS","MAX_VARYING_COMPONENTS","MAX_VERTEX_OUTPUT_COMPONENTS","MAX_VERTEX_UNIFORM_BLOCKS","MAX_VERTEX_UNIFORM_COMPONENTS","MIN_PROGRAM_TEXEL_OFFSET","PACK_ROW_LENGTH","PACK_SKIP_PIXELS","PACK_SKIP_ROWS","PIXEL_PACK_BUFFER_BINDING","PIXEL_UNPACK_BUFFER_BINDING","RASTERIZER_DISCARD","READ_BUFFER","READ_FRAMEBUFFER_BINDING","SAMPLE_ALPHA_TO_COVERAGE","SAMPLE_COVERAGE","SAMPLER_BINDING","TEXTURE_BINDING_2D_ARRAY","TEXTURE_BINDING_3D","TRANSFORM_FEEDBACK_ACTIVE","TRANSFORM_FEEDBACK_BINDING","TRANSFORM_FEEDBACK_BUFFER_BINDING","TRANSFORM_FEEDBACK_PAUSED","UNIFORM_BUFFER_BINDING","UNIFORM_BUFFER_OFFSET_ALIGNMENT","UNPACK_IMAGE_HEIGHT","UNPACK_ROW_LENGTH","UNPACK_SKIP_IMAGES","UNPACK_SKIP_PIXELS","UNPACK_SKIP_ROWS","VERTEX_ARRAY_BINDING"].map((r=>{a.push({name:r,val:e.getParameter(e[r])})}));var r=document.createElement("div");r.style.position="fixed",r.style.zIndex=1e5,r.style.left="50%",r.style.top="50%",r.style.transform="translate(-50%, -50%)",r.style.background="#0008",r.style.padding="20px",r.style.width="600px",r.style.height="350px",r.style.border="1px solid #fff4",r.style.borderRadius="5px",r.style.fontFamily="monospace",r.style.fontSize="20px",r.style.color="#fff";var t=document.createElement("div");t.style.fontSize="24px",t.style.color="#0f8c",t.innerHTML="rendering context parameters<br><br>",r.appendChild(t);var o=document.createElement("div");o.style.minWidth="100%",o.style.height="250px",o.style.background="#333",o.style.border="1px solid #fff4",o.style.overflowY="auto",o.style.wordWrap="break-word",o.style.color="#888",o.style.fontSize="10px",r.appendChild(o);var n=document.createElement("button");n.style.border="none",n.style.padding="3px",n.style.cursor="pointer",n.fontSize="20px",n.style.borderRadius="10px",n.style.margin="10px",n.style.minWidth="100px",n.innerHTML="📋 copy",n.title="copy shape data to clipboard",n.onclick=()=>{var e=document.createRange();e.selectNode(o),window.getSelection().removeAllRanges(),window.getSelection().addRange(e),document.execCommand("copy"),window.getSelection().removeAllRanges(),n.innerHTML="COPIED!",setTimeout((()=>{n.innerHTML="📋 copy"}),1e3)},r.appendChild(n);var i=document.createElement("button");i.onclick=()=>r.remove(),i.style.border="none",i.style.padding="3px",i.style.cursor="pointer",i.fontSize="20px",i.style.borderRadius="10px",i.style.margin="10px",i.style.background="#faa",i.style.minWidth="100px",i.innerHTML="close",r.appendChild(i),o.innerHTML=JSON.stringify(a),document.body.appendChild(r)};export{Renderer,LoadGeometry,BasicShader,DestroyViewport,DestroyShape,AnimationLoop,Tetrahedron,Cube,Octahedron,Icosahedron,Dodecahedron,Cylinder,Torus,TorusKnot,Rectangle,Q,R,SyncNormals,Normal,ImageToPo2,LoadOBJ,IsPowerOf2,RGBToHSV,HSVToHex,HexFromHSV,HSVToRGB,RGBFromHSV,HexFromRGB,RGBToHex,RGBFromHex,HexToRGB,GeoSphere};

