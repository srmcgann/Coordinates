const S=Math.sin,C=Math.cos,Rn=Math.random,scratchCanvas=document.createElement("canvas"),sctx=scratchCanvas.getContext("2d",{alpha:!0,antialias:!0,desynchronized:!0,premultipliedAlpha:!1}),scratchImage=new Image,moduleBase="https://srmcgann.github.io/Coordinates";var cacheItem;const cache={objFiles:[],customShapes:[],textures:[],geometry:[],texImages:[]},Renderer=e=>{var a=0,t=0,o=0,r=1920,n=1080,i=0,c=0,s=0,l=2e3,h=!0,f=10,p=!1,m=.2,u=!1,d={mode:"webgl2",options:{alpha:!0,antialias:!0,desynchronized:!0,premultipliedAlpha:!1}};void 0!==e&&Object.keys(e).forEach(((g,v)=>{switch(g.toLowerCase()){case"width":r=e[g];break;case"height":n=e[g];break;case"alpha":u=e[g];break;case"x":a=e[g];break;case"y":t=e[g];break;case"z":o=e[g];break;case"roll":i=e[g];break;case"pitch":c=e[g];break;case"yaw":s=e[g];break;case"fov":l=e[g];break;case"clearcolor":e[g];break;case"attachTobody":h=!!e[g];break;case"exportgpuspecs":p=!!e[g];break;case"margin":f=e[g];break;case"ambientlight":m=e[g];break;case"context":d.mode=e[g].mode,d.options=e[g].options}}));const g=document.createElement("canvas"),v=g.getContext(d.mode,d.options);g.width=r,g.height=n;const R=d[0];if(console.log(`GLSL version: ${v.getParameter(v.SHADING_LANGUAGE_VERSION)}`),p&&getParams(v),"2d"===R);else v.viewport(0,0,g.width,g.height);var y;h&&(g.style.display="block",g.style.position="absolute",g.style.left="50vw",g.style.top="50vh",g.style.transform="translate(-50%, -50%)",g.style.border="1px solid #fff3",g.style.background="#000",document.body.appendChild(g)),window.addEventListener("resize",y=e=>{var a,t=document.body,o=0!==g.width?g.height/g.width:1;t.clientHeight/t.clientWidth>o?(g.style.width=(a=t.clientWidth)-2*f+"px",g.style.height=a*o-2*f+"px"):(g.style.height=(a=t.clientHeight)-2*f+"px",g.style.width=a/o-2*f+"px")}),y();var b={c:g,ctx:v,contextType:R,t:0,alpha:u,width:r,height:n,x:a,y:t,z:o,roll:i,pitch:c,yaw:s,fov:l,ready:!1,ambientLight:m,pointLights:[],pointLightCols:[],spriteQueue:[]};b["2d"==R?"ctx":"gl"]=v;var E=b;E.Clear=()=>{if("2d"===R)g.width=E.c.width;else v.clearColor(0,0,0,1),v.clear(v.COLOR_BUFFER_BIT),v.clear(v.DEPTH_BUFFER_BIT)};return E.Draw=async(e,a=!1)=>{var t=e.shader.datasets[e.datasetIdx],o=t.program;if(void 0!==e?.shader)if(!a&&(e.isSprite||e.isLight&&e.pointLightShowSource))E.spriteQueue=[e,...E.spriteQueue];else{v.useProgram(o),v.activeTexture(v.TEXTURE0),"video"==e.textureMode&&BindImage(v,t.resource,t.texture,e.textureMode,E.t,e.map),v.uniform1i(t.locTexture,t.texture),v.bindTexture(v.TEXTURE_2D,t.texture),v.uniform1i(t.locPointLightCount,E.pointLights.length);var r=[],n=[];E.pointLights.map((e=>{r=[...r,e.x,e.y,e.z,e.lum];HexToRGB(e.color);n=[...n,...HexToRGB(e.color),1]})),r.length&&(v.uniform4fv(t.locPointLights,r),v.uniform4fv(t.locPointLightCols,n));var i=E.ambientLight;t.optionalLighting.map((e=>{if("ambientLight"===e.name)i=e.value})),v.useProgram(o),t.optionalUniforms.map((a=>{if("object"==typeof a?.loc)switch(v[a.dataType](a.loc,a.value),v.uniform1f(a.locFlatShading,a.flatShading?1:0),a.name){case"reflection":v.activeTexture(v.TEXTURE1),"video"==a.textureMode&&BindImage(v,a.video,a.refTexture,a.textureMode,E.t,a.map),v.activeTexture(v.TEXTURE1),v.uniform1i(a.locRefTexture,1),v.bindTexture(v.TEXTURE_2D,a.refTexture),v.uniform1f(a.locRefOmitEquirectangular,"rectangle"==e.shapeType||"point light"==e.shapeType||"sprite"==e.shapeType?1:0);break;case"phong":a.locPhongTheta=v.getUniformLocation(t.program,"phongTheta"),v.uniform1f(a.locPhongTheta,a.theta)}})),v.uniform1f(t.locT,E.t),v.uniform1f(t.locColorMix,e.colorMix),v.uniform1f(t.locIsSprite,e.isSprite),v.uniform1f(t.locIsLight,e.isLight),v.uniform1f(t.locAlpha,e.alpha),v.uniform3f(t.locColor,...HexToRGB(e.color)),v.uniform1f(t.locAmbientLight,i/16),v.uniform2f(t.locResolution,E.width,E.height),v.uniform3f(t.locCamPos,E.x,E.y,E.z),v.uniform3f(t.locCamOri,E.roll,E.pitch,E.yaw),v.uniform3f(t.locGeoPos,e.x,e.y,e.z),v.uniform3f(t.locGeoOri,e.roll,e.pitch,e.yaw),v.uniform1f(t.locFov,E.fov),v.uniform1f(t.locEquirectangular,e.equirectangular?1:0),v.uniform1f(t.locRenderNormals,0),v.bindBuffer(v.ARRAY_BUFFER,e.uv_buffer),v.bufferData(v.ARRAY_BUFFER,e.uvs,v.STATIC_DRAW),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,e.UV_Index_Buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,e.uvIndices,v.STATIC_DRAW),v.vertexAttribPointer(t.locUv,2,v.FLOAT,!1,0,0),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),v.bindBuffer(v.ARRAY_BUFFER,null),e?.normalVecs.length&&(v.bindBuffer(v.ARRAY_BUFFER,e.normalVec_buffer),v.bufferData(v.ARRAY_BUFFER,e.normalVecs,v.STATIC_DRAW),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,e.NormalVec_Index_Buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,e.nIndices,v.STATIC_DRAW),v.bindBuffer(v.ARRAY_BUFFER,e.normalVec_buffer),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,e.NormalVec_Index_Buffer),t.locNormalVec=v.getAttribLocation(t.program,"normalVec"),v.vertexAttribPointer(t.locNormalVec,3,v.FLOAT,!1,0,0),v.enableVertexAttribArray(t.locNormalVec),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),v.bindBuffer(v.ARRAY_BUFFER,null)),e?.vertices?.length&&(v.bindBuffer(v.ARRAY_BUFFER,e.vertex_buffer),v.bufferData(v.ARRAY_BUFFER,e.vertices,v.STATIC_DRAW),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,e.Vertex_Index_Buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,e.vIndices,v.STATIC_DRAW),v.bindBuffer(v.ARRAY_BUFFER,e.vertex_buffer),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,e.Vertex_Index_Buffer),t.locPosition=v.getAttribLocation(t.program,"position"),v.vertexAttribPointer(t.locPosition,3,v.FLOAT,!1,0,0),v.enableVertexAttribArray(t.locPosition),v.drawElements(v.TRIANGLES,e.vertices.length/3|0,v.UNSIGNED_INT,0),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),v.bindBuffer(v.ARRAY_BUFFER,null)),v.uniform1f(t.locRenderNormals,e.showNormals?1:0),e.showNormals&&e?.normals?.length&&(v.bindBuffer(v.ARRAY_BUFFER,e.normal_buffer),v.bufferData(v.ARRAY_BUFFER,e.normals,v.STATIC_DRAW),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,e.Normal_Index_Buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,e.nIndices,v.STATIC_DRAW),v.vertexAttribPointer(t.locNormal,3,v.FLOAT,!1,0,0),t.locNormal=v.getAttribLocation(t.program,"normal"),v.bindBuffer(v.ARRAY_BUFFER,e.normal_buffer),v.bufferData(v.ARRAY_BUFFER,e.normals,v.STATIC_DRAW),v.enableVertexAttribArray(t.locNormal),v.drawElements(v.LINES,e.normals.length/3|0,v.UNSIGNED_INT,0),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),v.bindBuffer(v.ARRAY_BUFFER,null))}},E},DestroyViewport=e=>{e.remove()},LoadOBJ=async(e,a,t,o,r,n,i,c,s=!0,l=!0)=>{var h,f={vertices:[],normals:[],uvs:[]};if(l&&(cacheItem=cache.objFiles.filter((a=>a.url==e))).length)f=cacheItem[0].ret;else{var p=[],m=[],u=[],d=[];await fetch(e).then((e=>e.text())).then((e=>{e.split("\n").forEach((e=>{var a=e.split(" ");switch(a[0]){case"v":a.shift(),p=[...p,a.map((e=>+e))];break;case"vt":a.shift(),u=[...u,a.map((e=>+e))];break;case"vn":a.shift(),m=[...m,a.map((e=>+e))];break;case"f":a.shift(),d=[...d,a.map((e=>e))]}})),d.map((e=>{var a,t,o,r=[],n=[],i=[];e.map((e=>{var c=e.split("/");switch(c.length){case 1:a=c[0],r=[...r,p[a-1]];break;case 2:a=c[0],t=c[1],r=[...r,p[a-1]],n=[...n,u[t-1]];break;case 3:a=c[0],t=c[1],o=c[2],r=[...r,p[a-1]],n=[...n,u[t-1]],i=[...i,m[o-1]]}}));var c=r[0][0],s=r[0][1],l=r[0][2],d=r[1][0],g=r[1][1],v=r[1][2],R=r[2][0],y=r[2][1],b=r[2][2],E=i[0][0],x=i[0][1],_=i[0][2],A=i[1][0],T=i[1][1],M=i[1][2],I=i[2][0],P=i[2][1],F=i[2][2];if(4==r.length)var S=r[3][0],C=r[3][1],L=r[3][2],B=i[3][0],U=i[3][1],w=i[3][2];switch(r.length){case 3:h=[],i.map(((e,a)=>{h=[...h,[c,s,l,c+E,s+x,l+_],[d,g,v,d+A,g+T,v+M],[R,y,b,R+I,y+P,b+F]]})),i=h,f.vertices=[...f.vertices,...r[0],...r[1],...r[2]],n.length&&void 0!==n[0]&&(f.uvs=[...f.uvs,...n[0],...n[1],...n[2]]),i.length&&void 0!==i[0]&&(f.normals=[...f.normals,...i[0],...i[1],...i[2]]);break;case 4:h=[],i.map(((e,a)=>{h=[...h,[c,s,l,c+E,s+x,l+_],[d,g,v,d+A,g+T,v+M],[R,y,b,R+I,y+P,b+F],[S,C,L,S+B,C+U,L+w]]})),i=h,f.vertices=[...f.vertices,...r[0],...r[1],...r[2],...r[2],...r[3],...r[0]],n.length&&(f.uvs=[...f.uvs,...n[0],...n[1],...n[2],...n[2],...n[3],...n[0]]),i.length&&(f.normals=[...f.normals,...i[0],...i[1],...i[2],...i[2],...i[3],...i[0]])}}))})),cache.objFiles=[...cache.objFiles,{url:e,ret:f}]}for(var g=0;g<f.uvs.length;g+=2)f.uvs[g+1]=1-f.uvs[g+1];for(g=0;g<f.normals.length;g+=3)f.normals[g+1]=-f.normals[g+1];for(g=0;g<f.vertices.length;g+=3){var v=[f.vertices[g+0],f.vertices[g+1],f.vertices[g+2]];i&&(v=R(...v,{roll:0,pitch:i,yaw:0})),c&&(v=R(...v,{roll:0,pitch:0,yaw:c})),n&&(v=R(...v,{roll:n,pitch:0,yaw:0})),f.vertices[g+0]=v[0],f.vertices[g+1]=v[1],f.vertices[g+2]=v[2];for(var y=2;y--;){var b=y?2*g:2*g+3;v=[f.normals[b+0],f.normals[b+1],f.normals[b+2]];i&&(v=R(...v,{roll:0,pitch:i,yaw:0})),c&&(v=R(...v,{roll:0,pitch:0,yaw:c})),n&&(v=R(...v,{roll:n,pitch:0,yaw:0})),f.normals[b+0]=v[0],f.normals[b+1]=v[1],f.normals[b+2]=v[2]}}return f},Q=(e,a,t,o,r=700)=>[o.width/2+e/t*r,o.height/2+a/t*r],R=(e,a,t,o,r=!1)=>{var n,i,c=Math,s=c.hypot,l=c.atan2,h=o.roll,f=o.pitch,p=o.yaw;(e=S(n=l(e,a)+h)*(i=s(e,a)),a=C(n)*i,e=S(n=l(e,t)+p)*(i=s(e,t)),t=C(n)*i,a=S(n=l(a,t)+f)*(i=s(a,t)),t=C(n)*i,r)&&(e+=o.x,a+=o.y,t+=o.z);return[e,a,t]},LoadGeometry=async(e,a)=>{var t,o,r,n,i,c,s,l,h,f,p,m,u,d,g,v,y,b,E;const x=e.gl;var _,A=!1,T=0,M=0,I=0,P=0,F=0,S=0,C=1,L=1,B=1,U=16,w=40,N="",k="",O=1,D=!1,z=0,V=0,G=3355443,Y=.1,H=!1,X=!1,W=!1,K="",q=!0,j=0,$=0,Q=1,Z=!0,J=!1,ee=!1,ae=1,te=1,oe=[],re=[],ne={};a=structuredClone(a),Object.keys(a).forEach(((e,t)=>{if("pointlightshowsource"===e.toLowerCase())J=!!a[e]})),Object.keys(a).forEach(((e,s)=>{switch(e.toLowerCase()){case"x":T=a[e];break;case"y":M=a[e];break;case"z":I=a[e];break;case"roll":P=a[e];break;case"pitch":F=a[e];break;case"yaw":S=a[e];break;case"shapetype":if("point light"===(g=a[e].toLowerCase()))K=J?`${moduleBase}/resources/stars/star.png`:"";break;case"size":O=a[e];break;case"subs":z=a[e];break;case"equirectangular":H=!!a[e];break;case"flipnormals":X=!!a[e];break;case"shownormals":W=!!a[e];break;case"sphereize":V=a[e];break;case"objx":t=a[e];break;case"objy":o=a[e];break;case"objz":r=a[e];break;case"objroll":n=a[e];break;case"objpitch":i=a[e];break;case"objyaw":c=a[e];break;case"scalex":C=a[e];break;case"scaley":L=a[e];break;case"scalez":B=a[e];break;case"name":k=a[e];break;case"color":G=a[e];break;case"colormix":Y=a[e];break;case"exportshape":A=!!a[e];break;case"url":N=a[e];break;case"map":K=a[e];break;case"rows":U=a[e];break;case"disabledepthtest":ee=a[e];break;case"cols":w=a[e];break;case"involvecache":Z=!!a[e];break;case"muted":q=!!a[e];break;case"lum":ae=a[e];break;case"alpha":te=a[e];break;case"geometrydata":oe=a[e];break;case"texcoords":re=a[e];break;case"issprite":j=a[e]?1:0;break;case"islight":$=a[e]?1:0;break;case"playbackspeed":Q=a[e];break;case"averagenormals":D=!!a[e];break;default:ne[e]=a[e]}})),V&&(D=!0);var ie,ce,se=[],le=[],he=[],fe=[],pe=!1;if(-1!=g.indexOf("custom shape"))ie=N,ce=`${g} ${k} (${N})`;else if(ce=`${g}_${z}`,z<5&&ce)switch(ce){case"tetrahedron_0":case"tetrahedron_1":case"tetrahedron_2":case"tetrahedron_3":case"tetrahedron_4":case"cube_0":case"cube_1":case"cube_2":case"cube_3":case"cube_4":case"octahedron_0":case"octahedron_1":case"octahedron_2":case"octahedron_3":case"octahedron_4":case"dodecahedron_0":case"dodecahedron_1":case"dodecahedron_2":case"dodecahedron_3":case"dodecahedron_4":case"icosahedron_0":case"icosahedron_1":case"icosahedron_2":case"icosahedron_3":case"icosahedron_4":case"cylinder_0":case"torus_0":case"torus knot_0":("cylinder_0"!=ce||"torus_0"!=ce||"cylinder_0"==ce&&16==U&&40==w||"torus_0"==ce&&16==U&&40==w||"torus knot_0"==ce&&16==U&&40==w)&&(pe=!0,ie=`${N=`${moduleBase}/new%20shapes/`}${ce}.json`)}if(pe)await fetch(ie).then((e=>e.json())).then((e=>{se=e.vertices,le=e.normals,he=e.normalVecs,fe=e.uvs,pe=!0}));else if("custom shape"===g){if(Z&&(cacheItem=cache.customShapes.filter((e=>e.url==N))).length){var me=cacheItem[0].data;se=me.vertices,le=me.normals,he=me.normalVecs,fe=me.uvs,console.log("found custom shape found in cache. using it"),pe=!0}pe||await fetch(ie).then((e=>e.json())).then((e=>{se=e.vertices,le=e.normals,he=e.normalVecs,fe=e.uvs,pe=!0,cache.customShapes.push({data:e,url:N})}))}if(pe)switch(g){case"tetrahedron":case"octahedron":case"dodecahedron":case"icosahedron":H=!0}else{switch(g){case"tetrahedron":H=!0,(_=await Tetrahedron(O,z,V,X,g)).geometry.map((e=>{se=[...se,...e.position],le=[...le,...e.normal],fe=[...fe,...e.texCoord]}));break;case"octahedron":H=!0,(_=await Octahedron(O,z,V,X,g)).geometry.map((e=>{se=[...se,...e.position],le=[...le,...e.normal],fe=[...fe,...e.texCoord]}));break;case"icosahedron":H=!0,(_=await Icosahedron(O,z,V,X,g)).geometry.map((e=>{se=[...se,...e.position],le=[...le,...e.normal],fe=[...fe,...e.texCoord]}));break;case"torus":(_=await Torus(O,z,V,X,g,U,w)).geometry.map((e=>{se=[...se,...e.position],le=[...le,...e.normal],fe=[...fe,...e.texCoord]}));break;case"torus knot":(_=await TorusKnot(O,z,V,X,g,U,w)).geometry.map((e=>{se=[...se,...e.position],le=[...le,...e.normal],fe=[...fe,...e.texCoord]}));break;case"cylinder":(_=await Cylinder(O,z,V,X,g,U,w)).geometry.map((e=>{se=[...se,...e.position],le=[...le,...e.normal],fe=[...fe,...e.texCoord]}));break;case"dynamic":(_=await GeometryFromRaw(oe,re,O,z,V,X,!!oe.filter((e=>4==e.length)).length,"dynamic")).geometry.map((e=>{se=[...se,...e.position],le=[...le,...e.normal],void 0!==e.texCoord&&e.texCoord.length&&(fe=[...fe,...e.texCoord])}));break;case"cube":(_=await Cube(O,z,V,X,g)).geometry.map((e=>{se=[...se,...e.position],le=[...le,...e.normal],fe=[...fe,...e.texCoord]}));break;case"rectangle":(_=await Rectangle(O,z,V,X,g)).geometry.map((e=>{se=[...se,...e.position],le=[...le,...e.normal],fe=[...fe,...e.texCoord]}));break;case"sprite":j=!0,(_=await Rectangle(O,z,V,X,g)).geometry.map((e=>{se=[...se,...e.position],le=[...le,...e.normal],fe=[...fe,...e.texCoord]}));break;case"point light":$=!0,(_=J?await Rectangle(Math.max(O,.5),z-1,V,X,g):{geometry:[]}).geometry.map((e=>{se=[...se,...e.position],le=[...le,...e.normal],fe=[...fe,...e.texCoord]}));break;case"obj":void 0===t&&(t=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===c&&(c=0),_=await LoadOBJ(N,0,0,0,0,n,i,c,!1),se=_.vertices,le=_.normals,fe=_.uvs;break;case"dodecahedron":H=!0,(_=await Dodecahedron(O,z,V,X,g)).geometry.map((e=>{se=[...se,...e.position],le=[...le,...e.normal],fe=[...fe,...e.texCoord]}))}for(var ue=0;ue<se.length;ue+=3)se[ue+0]*=C,se[ue+1]*=L,se[ue+2]*=B;if("obj"!=g&&"customShape"!=g)for(ue=0;ue<le.length;ue+=6){var de=le[ue+3]-le[ue+0],ge=le[ue+4]-le[ue+1],ve=le[ue+5]-le[ue+2];le[ue+0]*=C,le[ue+1]*=L,le[ue+2]*=B,le[ue+3]=le[ue+0]+de,le[ue+4]=le[ue+1]+ge,le[ue+5]=le[ue+2]+ve}}if("custom shape"!=g&&"obj"!=g||V||C||L||B){var Re=V,ye=1-V;for(ue=0;ue<se.length;ue+=3){var be,Ee=se[ue+0],xe=se[ue+1],_e=se[ue+2];Ee/=be=Math.hypot(Ee,xe,_e)+1e-4,xe/=be,_e/=be,Ee*=Re+be*ye,xe*=Re+be*ye,_e*=Re+be*ye,se[ue+0]=Ee*O*C,se[ue+1]=xe*O*L,se[ue+2]=_e*O*B;var Ae=le[2*ue+0],Te=le[2*ue+1],Me=le[2*ue+2];le[2*ue+0]+=se[ue+0]-Ae,le[2*ue+1]+=se[ue+1]-Te,le[2*ue+2]+=se[ue+2]-Me,le[2*ue+3]+=se[ue+0]-Ae,le[2*ue+4]+=se[ue+1]-Te,le[2*ue+5]+=se[ue+2]-Me,le[2*ue+0]*=C,le[2*ue+1]*=L,le[2*ue+2]*=B,le[2*ue+3]*=C,le[2*ue+4]*=L,le[2*ue+5]*=B}}if(t||o||r||n||i||c){var Ie;void 0===t&&(t=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===c&&(c=0);for(ue=0;ue<le.length;ue+=6)T=le[ue+0],xe=le[ue+1],_e=le[ue+2],Ie=R(Ee,xe,_e,{roll:n,pitch:i,yaw:c},!1),le[ue+0]=Ie[0]+t,le[ue+1]=Ie[1]+o,le[ue+2]=Ie[2]+r,T=le[ue+3],xe=le[ue+4],_e=le[ue+5],Ie=R(Ee,xe,_e,{roll:n,pitch:i,yaw:c},!1),le[ue+3]=Ie[0]+t,le[ue+4]=Ie[1]+o,le[ue+5]=Ie[2]+r;for(ue=0;ue<se.length;ue+=3)T=se[ue+0],xe=se[ue+1],_e=se[ue+2],Ie=R(Ee,xe,_e,{roll:n,pitch:i,yaw:c},!1),se[ue+0]=Ie[0]+t,se[ue+1]=Ie[1]+o,se[ue+2]=Ie[2]+r}if(D&&AverageNormals(se,le,g),!pe||D||A){he=[];for(ue=0;ue<le.length;ue+=6){let e=le[ue+3]-le[ue+0],a=le[ue+4]-le[ue+1],t=le[ue+5]-le[ue+2];he=[...he,e,a,t]}}if(X&&!A){for(ue=0;ue<le.length;ue+=6)le[ue+3]=le[ue+0]-(le[ue+3]-le[ue+0]),le[ue+4]=le[ue+1]-(le[ue+4]-le[ue+1]),le[ue+5]=le[ue+2]-(le[ue+5]-le[ue+2]);for(ue=0;ue<he.length;ue+=3)he[ue+0]*=-1,he[ue+1]*=-1,he[ue+2]*=-1}if(A&&"background"!==k){var Pe=document.createElement("div");Pe.style.position="fixed",Pe.style.zIndex=1e5,Pe.style.left="50%",Pe.style.top="50%",Pe.style.transform="translate(-50%, -50%)",Pe.style.background="#0008",Pe.style.padding="20px",Pe.style.width="600px",Pe.style.height="350px",Pe.style.border="1px solid #fff4",Pe.style.borderRadius="5px",Pe.style.fontFamily="monospace",Pe.style.fontSize="20px",Pe.style.color="#fff";var Fe=document.createElement("div");Fe.style.fontSize="24px",Fe.style.color="#0f8c",Fe.innerHTML=`Export Coordinates File -> ${g} `+(a?.name?`(${a.name})`:"")+"<br><br>",Pe.appendChild(Fe);var Se=document.createElement("div");Se.style.minWidth="100%",Se.style.height="250px",Se.style.background="#333",Se.style.border="1px solid #fff4",Se.style.overflowY="auto",Se.style.wordWrap="break-word",Se.style.color="#888",Se.style.fontSize="10px",Pe.appendChild(Se);var Ce=document.createElement("button");Ce.style.border="none",Ce.style.padding="3px",Ce.style.cursor="pointer",Ce.fontSize="20px",Ce.style.borderRadius="10px",Ce.style.margin="10px",Ce.style.minWidth="100px",Ce.innerHTML="📋 copy",Ce.title="copy shape data to clipboard",Ce.onclick=()=>{var e=document.createRange();e.selectNode(Se),window.getSelection().removeAllRanges(),window.getSelection().addRange(e),document.execCommand("copy"),window.getSelection().removeAllRanges(),Ce.innerHTML="COPIED!",setTimeout((()=>{Ce.innerHTML="📋 copy"}),1e3)},Pe.appendChild(Ce);var Le=document.createElement("button");Le.onclick=()=>Pe.remove(),Le.style.border="none",Le.style.padding="3px",Le.style.cursor="pointer",Le.fontSize="20px",Le.style.borderRadius="10px",Le.style.margin="10px",Le.style.background="#faa",Le.style.minWidth="100px",Le.innerHTML="close",Pe.appendChild(Le);var Be={vertices:[],normals:[],normalVecs:[],uvs:[]};se.map((e=>Be.vertices.push(Math.round(1e3*e)/1e3)));for(ue=0;ue<le.length;ue+=6){var Ue=le[ue+0],we=le[ue+1],Ne=le[ue+2],ke=X?le[ue+0]-(le[ue+3]-le[ue+0]):le[ue+3],Oe=X?le[ue+1]-(le[ue+4]-le[ue+1]):le[ue+4],De=X?le[ue+2]-(le[ue+5]-le[ue+2]):le[ue+5];Ue=Math.round(1e3*Ue)/1e3,we=Math.round(1e3*we)/1e3,Ne=Math.round(1e3*Ne)/1e3,ke=Math.round(1e3*ke)/1e3,Oe=Math.round(1e3*Oe)/1e3,De=Math.round(1e3*De)/1e3,Be.normals.push(Ue,we,Ne,ke,Oe,De)}for(ue=0;ue<he.length;ue++)Be.normalVecs.push((X?-1:1)*Math.round(1e3*he[ue])/1e3);fe.map((e=>Be.uvs.push(Math.round(1e3*e)/1e3))),Se.innerHTML=JSON.stringify(Be),document.body.appendChild(Pe)}se=new Float32Array(se),le=new Float32Array(le),he=new Float32Array(he),fe=new Float32Array(fe),s=x.createBuffer(),x.bindBuffer(x.ARRAY_BUFFER,s),x.bufferData(x.ARRAY_BUFFER,se,x.STATIC_DRAW),x.bindBuffer(x.ARRAY_BUFFER,null),v=new Uint32Array(Array(se.length/3).fill().map(((e,a)=>a))),l=x.createBuffer(),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,l),x.bufferData(x.ELEMENT_ARRAY_BUFFER,v,x.STATIC_DRAW),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,null),p=x.createBuffer(),x.bindBuffer(x.ARRAY_BUFFER,p),x.bufferData(x.ARRAY_BUFFER,he,x.STATIC_DRAW),x.bindBuffer(x.ARRAY_BUFFER,null),b=new Uint32Array(Array(he.length/3).fill().map(((e,a)=>a))),m=x.createBuffer(),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,m),x.bufferData(x.ELEMENT_ARRAY_BUFFER,b,x.STATIC_DRAW),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,null),h=x.createBuffer(),x.bindBuffer(x.ARRAY_BUFFER,h),x.bufferData(x.ARRAY_BUFFER,le,x.STATIC_DRAW),x.bindBuffer(x.ARRAY_BUFFER,null),y=new Uint32Array(Array(le.length/3).fill().map(((e,a)=>a))),f=x.createBuffer(),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,f),x.bufferData(x.ELEMENT_ARRAY_BUFFER,y,x.STATIC_DRAW),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,null),u=x.createBuffer(),x.bindBuffer(x.ARRAY_BUFFER,u),x.bufferData(x.ARRAY_BUFFER,fe,x.STATIC_DRAW),x.bindBuffer(x.ARRAY_BUFFER,null),E=new Uint32Array(Array(fe.length/2).fill().map(((e,a)=>a))),d=x.createBuffer(),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,d),x.bufferData(x.ELEMENT_ARRAY_BUFFER,E,x.STATIC_DRAW),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,null);var ze={x:T,y:M,z:I,roll:P,pitch:F,yaw:S,color:G,colorMix:Y,size:O,subs:z,name:k,url:N,averageNormals:D,showNormals:W,shapeType:g,exportShape:A,sphereize:V,equirectangular:H,flipNormals:X,vertices:se,normals:le,normalVecs:he,uvs:fe,vertex_buffer:s,Vertex_Index_Buffer:l,normal_buffer:h,Normal_Index_Buffer:f,muted:q,normalVec_buffer:p,NormalVec_Index_Buffer:m,nVecIndices:b,uv_buffer:u,UV_Index_Buffer:d,vIndices:v,nIndices:y,uvIndices:E,map:K,video:undefined,textureMode:"image",isSprite:j,isLight:$,playbackSpeed:Q,disableDepthTest:ee,lum:ae,alpha:te,involveCache:Z};Object.keys(ze).forEach(((e,a)=>{ne[e]=ze[e]})),"point light"==g&&(void 0===a.color&&(ne.color=11184810),e.pointLights.push(ne));const Ve=await BasicShader(e,[{uniform:{type:"phong",value:0}}]);return await Ve.ConnectGeometry(ne,!0),ne},GenericPopup=async(e="",a=!1,t=(()=>{}),o=400,r=300)=>{var n=document.createElement("div");n.style.position="fixed",n.style.zIndex=1e5,n.style.left="50%",n.style.top="50%",n.style.transform="translate(-50%, -50%)",n.style.background="#0008",n.style.padding="20px",n.style.width=`${o}px`,n.style.height=`${r}px`,n.style.border="1px solid #fff4",n.style.borderRadius="5px",n.style.fontFamily="monospace",n.style.fontSize="20px",n.style.color="#fff";var i=document.createElement("div");if(i.style.fontSize="24px",i.style.color="#0f8c",i.innerHTML=e,n.appendChild(i),a){var c=document.createElement("button");c.onclick=()=>{t(),n.remove()},c.style.border="none",c.style.padding="3px",c.style.cursor="pointer",c.fontSize="20px",c.style.borderRadius="10px",c.style.margin="10px",c.style.background="#faa",c.style.minWidth="100px",c.innerHTML="SURE!",n.appendChild(c)}var s=document.createElement("button");s.onclick=()=>n.remove(),s.style.border="none",s.style.padding="3px",s.style.cursor="pointer",s.fontSize="20px",s.style.borderRadius="10px",s.style.margin="10px",s.style.background="#faa",s.style.minWidth="100px",s.innerHTML="close",n.appendChild(s),document.body.appendChild(n)},ImageToPo2=e=>{let a=e;if(!IsPowerOf2(e.width)||!IsPowerOf2(e.height)){let t,o,r=document.createElement("canvas"),n=r.getContext("2d"),i=8,c=0,s=6e6,l=Math.hypot(e.width,e.height);for(let e=0;e<16;e++)(t=Math.abs(c-l))<s&&(s=t,c=i*2**e,o=e);c-=i*2**(o-1),r.width=c,r.height=c,n.drawImage(e,0,0,r.width,r.height),a=new Image,a=r}return a},VideoToImage=e=>{if(void 0!==e){let a,t;if(scratchCanvas.width!=e.videoWidth||scratchCanvas.height!=e.videoHeight?(a=e.videoWidth,t=e.videoHeight):(a=scratchCanvas.width,t=scratchCanvas.height),!IsPowerOf2(a)||!IsPowerOf2(t)){let e,o,r=8,n=0,i=6e6,c=Math.hypot(a,t);for(let a=0;a<12;a++)(e=Math.abs(n-c))<i&&(i=e,n=r*2**a,o=a);n-=r*2**(o-1),n=Math.min(1024,n),a=n/1,t=n/1}return scratchCanvas.width=a,scratchCanvas.height=t,sctx.drawImage(e,0,0,scratchCanvas.width,scratchCanvas.height),scratchCanvas}return scratchCanvas.width=1,scratchCanvas.height=1,scratchCanvas},BindImage=(e,a,t,o="image",r=-1,n="",i=!0)=>{let c;switch(o){case"video":i&&(cacheItem=cache.texImages.filter((e=>e.url==n&&-1!=r&&e.tVal==r))).length?(console.log("found video texture in cache... using it"),c=cacheItem[0].texImage):(c=VideoToImage(a),-1==r&&cache.texImages.push({url:n,tval:r,texImage:c}));break;case"image":i&&(cacheItem=cache.texImages.filter((e=>e.url==n))).length?(console.log("found image texture in cache... using it"),c=cacheItem[0].texImage):(c=ImageToPo2(a),-1==r&&cache.texImages.push({url:n,tval:r,texImage:c}))}e.bindTexture(e.TEXTURE_2D,t),c.width&&c.height&&e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)},AverageNormals=(e,a,t)=>{a.length=0;for(var o,r=IsPolyhedron(t),n=0;n<e.length;n+=3)n%9||(o=Normal([[e[n+0],e[n+1],e[n+2]],[e[n+3],e[n+4],e[n+5]],[e[n+6],e[n+7],e[n+8]]],r)),a[2*n+0]=e[n+0],a[2*n+1]=e[n+1],a[2*n+2]=e[n+2],a[2*n+3]=e[n+0]+(o[0]-o[3]),a[2*n+4]=e[n+1]+(o[1]-o[4]),a[2*n+5]=e[n+2]+(o[2]-o[5]);var i,c,s,l,h,f,p,m,u,d,g,v,R,y=structuredClone(a);for(n=0;n<a.length;n+=6){h=a[n+0],f=a[n+1],p=a[n+2],c=a[n+3],s=a[n+4],l=a[n+5],i=1;for(var b=0;b<a.length;b+=6)b!=n&&(m=a[b+0],u=a[b+1],d=a[b+2],g=a[b+3],v=a[b+4],R=a[b+5],Math.hypot(h-m,f-u,p-d)<.01&&(c+=g,s+=v,l+=R,i++));y[n+3]=c/=i,y[n+4]=s/=i,y[n+5]=l/=i}y.map(((e,t)=>a[t]=e))},BasicShader=async(e,a=[])=>{const t=e.gl;var o={iURL:null,locT:null,locUv:null,locFov:null,program:null,optionalUniforms:[],optionalLighting:[]};a.map((a=>{Object.keys(a).forEach(((t,r)=>{switch(t.toLowerCase()){case"lighting":if("ambientlight"===a[t].type.toLowerCase())if(void 0===a[t]?.enabled||a[t].enabled){var n={name:a[t].type,value:void 0===a[t].value?e.ambientLight:a[t].value};o.optionalLighting.push(n)}break;case"uniform":switch(a[t].type.toLowerCase()){case"reflection":if(void 0===a[t]?.enabled||a[t].enabled){var i={name:a[t].type,playbackSpeed:void 0===a[t].playbackSpeed?1:a[t].playbackSpeed,involveCache:void 0===a[t].involveCache||a[t].involveCache,muted:void 0===a[t].muted||a[t].muted,map:a[t].map,loc:"locReflection",value:void 0===a[t].value?.5:a[t].value,flatShading:void 0!==a[t].flatShading&&a[t].flatShading,flipReflections:void 0!==a[t].flipReflections&&a[t].flipReflections,flatShadingUniform:"refFlatShading",dataType:"uniform1f",vertDeclaration:"\n                    varying vec3 reflectionPos;\n                  ",vertCode:"\n                    reflectionPos = R(nVeci, geoOri);\n                  ",fragDeclaration:"\n                    uniform float reflection;\n                    uniform float refFlatShading;\n                    uniform float refOmitEquirectangular;\n                    uniform float refFlipRefs;\n                    uniform sampler2D reflectionMap;\n                    varying vec3 reflectionPos;\n                  ",fragCode:"\n                    //light.rgb *= .5;\n                    //light.rgb += .05;\n                    float refP1, refP2;\n                    if(refOmitEquirectangular != 1.0){\n                      float px = reflectionPos.x;\n                      float py = reflectionPos.y;\n                      float pz = reflectionPos.z;\n                      refP1 = -atan(px, pz)/ M_PI / 2.0 + camOri.z / M_PI / 2.0;\n                      refP2 = acos( py / (.001 + sqrt(px * px + py * py + pz * pz))) / M_PI;\n                      if(refFlipRefs != 0.0) refP2 = 1.0 - refP2;\n                    } else {\n                      refP1 = vUv.x;\n                      refP2 = vUv.y;\n                    }\n                    \n                    vec2 refCoords = vec2(1.0 - refP1, refP2);\n                    vec4 refCol = vec4(texture2D(reflectionMap, vec2(refCoords.x, refCoords.y)).rgb * 1.25, reflection / 1.0);\n                    mixColor = merge(mixColor, refCol);\n                    baseColorIp = 1.0 - reflection;\n                    //light += reflection / 4.0;\n                  "};o.optionalUniforms.push(i)}break;case"phong":if(void 0===a[t]?.enabled||a[t].enabled){i={name:a[t].type,loc:"locPhong",value:void 0===a[t].value?.3:a[t].value,flatShading:void 0!==a[t].flatShading&&a[t].flatShading,flatShadingUniform:"phongFlatShading",theta:void 0===a[t].theta?.3+Math.PI:a[t].theta,dataType:"uniform1f",vertDeclaration:"\n                    varying vec3 phongPos;\n                  ",vertCode:"\n                    phongPos = nVeci; //R(nVeci, geoOri);\n                    hasPhong = 1.0;\n                  ",fragDeclaration:"\n                    uniform float phong;\n                    uniform float phongTheta;\n                    uniform float phongFlatShading;\n                    varying vec3 phongPos;\n                  ",fragCode:"\n                    if(isLight == 0.0 && isSprite == 0.0){\n                      //light.rgb *= .5;\n                      float phongP1, phongP2;\n                      float px, py, pz;\n                      if(phongFlatShading != 0.0){\n                        px = 0.0;\n                        py = 0.0;\n                        pz = 0.0;\n                      }else{\n                        px = phongPos.x;\n                        py = phongPos.y;\n                        pz = phongPos.z;\n                      }\n                      phongP1 = atan(px, pz) + phongTheta;\n                      phongP2 = -acos( py / (.001 + sqrt(px * px + py * py + pz * pz)));\n\n                      float fact = pow(pow((1.0+cos(phongP1)) * (1.0+cos(phongP2+M_PI/2.0-.2)), 3.0), 3.0) / 5e5 * phong ;\n                      light = vec4(light.rgb + fact, 1.0) * 15.0;\n                    }\n                  "};o.optionalUniforms.push(i)}}}}))}));let r={ConnectGeometry:null,datasets:[]};t.enable(t.DEPTH_TEST),t.cullFace(t.BACK),e.alpha&&(t.blendFunc(t.SRC_ALPHA,t.ONE),t.enable(t.BLEND),t.disable(t.DEPTH_TEST));let n="";o.optionalUniforms.map((e=>{n+="\n"+e.vertDeclaration+"\n"}));let i="";o.optionalUniforms.map((e=>{i+="\n"+e.vertCode+"\n"}));let c="";o.optionalUniforms.map((e=>{c+="\n"+e.fragDeclaration+"\n"}));let s="";o.optionalUniforms.map((e=>{s+="\n"+e.fragCode+"\n"})),r.vert=`\n    precision highp float;\n    #define M_PI 3.14159265358979323\n    attribute vec2 uv;\n    ${n}\n    \n    uniform float t;\n    uniform vec3 color;\n    uniform float ambientLight;\n    uniform vec3 camPos;\n    uniform vec3 camOri;\n    uniform vec3 geoPos;\n    uniform vec3 geoOri;\n    uniform float isSprite;\n    uniform float isLight;\n    //uniform vec4 pointLightPos[16];\n    uniform float fov;\n    uniform float equirectangular;\n    uniform float renderNormals;\n    uniform vec2 resolution;\n    attribute vec3 position;\n    attribute vec3 normal;\n    attribute vec3 normalVec;\n    varying vec2 vUv;\n    varying vec2 uvi;\n    varying vec3 nVec;\n    varying vec3 nVeci;\n    varying vec3 fPos;\n    varying vec3 fPosi;\n    varying vec3 vnorm;\n    varying float skip;\n    varying float hasPhong;\n    \n    \n    vec3 R(vec3 pos, vec3 rot){\n      float p, d;\n      pos.x = sin(p=atan(pos.x,pos.z)+rot.z)*(d=sqrt(pos.x*pos.x+pos.z*pos.z));\n      pos.z = cos(p)*d;\n      pos.y = sin(p=atan(pos.y,pos.z)+rot.y)*(d=sqrt(pos.y*pos.y+pos.z*pos.z));\n      pos.z = cos(p)*d;\n      pos.x = sin(p=atan(pos.x,pos.y)+rot.x)*(d=sqrt(pos.x*pos.x+pos.y*pos.y));\n      pos.y = cos(p)*d;\n      return pos;\n    }\n    \n    void main(){\n      hasPhong = 0.0;\n      \n      float cx, cy, cz;\n      if(renderNormals == 1.0){\n        cx = normal.x;\n        cy = normal.y;\n        cz = normal.z;\n      }else{\n        cx = position.x;\n        cy = position.y;\n        cz = position.z;\n      }\n      \n      \n      uvi = uv / 2.0;\n      uvi = vec2(uvi.x, .5 - uvi.y);\n      \n      nVeci = normalVec;\n      \n      fPosi = position;\n      vnorm = normal;\n      \n      \n      // camera rotation\n      \n      vec3 geo, pos;\n      \n      if(isSprite != 0.0 || isLight != 0.0){\n        \n        geo = R(geoPos, camOri);\n        pos = R(vec3(cx, cy, cz),\n                 vec3(0.0, -camOri.y + M_PI, 0.0));\n        pos = R(vec3(pos.x, pos.y, pos.z),\n                 vec3(-camOri.x, 0.0, -camOri.z ));\n        pos = R(vec3(pos.x, pos.y, pos.z), camOri);\n        nVec = vec3(normalVec.x, normalVec.y, normalVec.z);\n        nVec = R(nVec, geoOri);\n        nVec = R(nVec, vec3(0.0, camOri.y, camOri.z));\n\n      }else{\n        geo = R(geoPos, camOri);\n        pos = R(vec3(cx, cy, cz), geoOri);\n        pos = R(vec3(pos.x, pos.y, pos.z), camOri);\n        nVec = vec3(normalVec.x, normalVec.y, normalVec.z);\n        nVec = R(nVec, geoOri);\n        nVec = R(nVec, vec3(0.0, camOri.y, camOri.z));\n      }\n      fPos = vec3(pos.x, pos.y, pos.z);\n      \n      ${i}\n      \n      float camz = camPos.z / 1e3 * pow(5.0, (log(fov) / 1.609438));\n      \n      float Z = pos.z + camz + geo.z;\n      if(Z > 0.0) {\n        float X = ((pos.x + camPos.x + geo.x) / Z * fov / resolution.x);\n        float Y = ((pos.y + camPos.y + geo.y) / Z * fov / resolution.y);\n        //gl_PointSize = 100.0 / Z;\n        gl_Position = vec4(X, Y, Z/100000.0, 1.0);\n        skip = 0.0;\n        vUv = uv;\n      }else{\n        skip = 1.0;\n      }\n    }\n  `,r.frag=`\n    precision highp float;\n    #define M_PI 3.14159265358979323\n    ${c}\n    uniform float t;\n    uniform vec2 resolution;\n    uniform float flatShading;\n    uniform float isSprite;\n    uniform float isLight;\n    uniform vec4 pointLightPos[128];\n    uniform vec4 pointLightCol[128];\n    uniform int pointLightCount;\n    uniform float ambientLight;\n    uniform float renderNormals;\n    uniform float equirectangular;\n    uniform float colorMix;\n    uniform vec3 color;\n    uniform sampler2D baseTexture;\n    uniform float alpha;\n    uniform vec3 camPos;\n    uniform vec3 camOri;\n    uniform vec3 geoPos;\n    uniform vec3 geoOri;\n    varying vec2 vUv;\n    varying vec2 uvi;\n    varying vec3 vnorm;\n    varying vec3 nVec;\n    varying vec3 nVeci;\n    varying vec3 fPos;\n    varying vec3 fPosi;\n    varying float skip;\n    varying float hasPhong;\n\n    vec4 merge (vec4 col1, vec4 col2){\n      return vec4((col1.rgb * col1.a) + (col2.rgb * col2.a), 1.0);\n    }\n    \n    vec2 Coords(float flatShading) {\n      if(equirectangular == 1.0){\n        float p;\n        float p2;\n        p = flatShading == 1.0 ? atan(nVeci.x, nVeci.z): atan(fPosi.x, fPosi.z);\n        float p1;\n        p1 = p / M_PI / 2.0;\n        p2 = flatShading == 1.0 ?\n              acos(nVeci.y / (sqrt(nVeci.x*nVeci.x + nVeci.y*nVeci.y + nVec.z*nVeci.z)+.00001)) / M_PI   :\n              p2 = acos(fPosi.y / (sqrt(fPosi.x*fPosi.x + fPosi.y*fPosi.y + fPosi.z*fPosi.z)+.00001)) / M_PI;\n        return vec2(p1, p2);\n      }else{\n        return vUv;\n      }\n    }\n\n    vec3 R(vec3 pos, vec3 rot){\n      float p, d;\n      pos.x = sin(p=atan(pos.x,pos.z)+rot.z)*(d=sqrt(pos.x*pos.x+pos.z*pos.z));\n      pos.z = cos(p)*d;\n      pos.y = sin(p=atan(pos.y,pos.z)+rot.y)*(d=sqrt(pos.y*pos.y+pos.z*pos.z));\n      pos.z = cos(p)*d;\n      pos.x = sin(p=atan(pos.x,pos.y)+rot.x)*(d=sqrt(pos.x*pos.x+pos.y*pos.y));\n      pos.y = cos(p)*d;\n      return pos;\n    }\n    \n    vec4 GetPointLight(){\n      \n      float ret = 0.0;\n      vec4 rgba = vec4(0.0, 0.0, 0.0, 1.0);\n      for(int i=0; i < 16; i++){\n        if(i >= pointLightCount) break;\n        vec3 lpos = pointLightPos[i].xyz;\n        lpos.x -= geoPos.x;\n        lpos.y -= geoPos.y;\n        lpos.z -= geoPos.z;\n        lpos = R(lpos, vec3(camOri.x, 0.0, camOri.z ));\n        lpos = R(lpos, vec3(0.0, camOri.y, 0.0));\n\n        float mag = pointLightPos[i].w;\n        ret = mag / (1.0 + pow(1.0 + sqrt((lpos.x-fPos.x) * (lpos.x-fPos.x) +\n                     (lpos.y-fPos.y) * (lpos.y-fPos.y) +\n                     (lpos.z-fPos.z) * (lpos.z-fPos.z)), 2.0) / 3.0) * 40.0;\n        \n        rgba.r += ret * pointLightCol[i].r;\n        rgba.g += ret * pointLightCol[i].g;\n        rgba.b += ret * pointLightCol[i].b;\n      }\n      \n      return pointLightCount > 0 ? vec4(rgba.rgb + ambientLight, 1.0) : vec4(ambientLight, ambientLight, ambientLight, 1.0);\n    }\n\n    void main() {\n      float mixColorIp = colorMix;\n      float baseColorIp = 1.0 - mixColorIp;\n      vec4 mixColor = vec4(color.rgb, mixColorIp);\n      vec4 light = hasPhong == 1.0 ? GetPointLight() :\n            vec4(ambientLight, ambientLight, ambientLight, 1.0);\n      float colorMag = 1.0;\n      if(skip != 1.0){\n        if(renderNormals == 1.0){\n          gl_FragColor = vec4(1.0, 0.0, 0.0, 0.5);\n        }else{\n          ${s}\n          vec4 texel = texture2D( baseTexture, Coords(0.0));\n          if(isSprite != 0.0 || isLight != 0.0){\n            gl_FragColor = vec4(texel.rgb * 2.0, texel.a * alpha);\n          }else{\n            texel.a = baseColorIp;\n            vec4 col = merge(mixColor, texel);\n            col.rgb *= light.rgb;\n            gl_FragColor = vec4(col.rgb * colorMag, 1.0);\n          }\n        }\n      }\n    }\n  `;const l=t.createShader(t.VERTEX_SHADER);t.shaderSource(l,r.vert),t.compileShader(l);const h=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(h,r.frag),t.compileShader(h),r.ConnectGeometry=async(a,n=!1)=>{var i=a.involveCache,c=structuredClone(o);r.datasets=[...r.datasets,c],c.program=t.createProgram(),t.attachShader(c.program,l),t.attachShader(c.program,h),t.linkProgram(c.program),a.shader=r;var s=a.map;if(a.datasetIdx=r.datasets.length-1,t.getProgramParameter(c.program,t.LINK_STATUS)){if(t.useProgram(c.program),t.bindBuffer(t.ARRAY_BUFFER,a.vertex_buffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.Vertex_Index_Buffer),c.locPosition=t.getAttribLocation(c.program,"position"),t.vertexAttribPointer(c.locPosition,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(c.locPosition),t.bindBuffer(t.ARRAY_BUFFER,a.uv_buffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.UV_Index_Buffer),c.locUv=t.getAttribLocation(c.program,"uv"),t.vertexAttribPointer(c.locUv,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(c.locUv),t.bindBuffer(t.ARRAY_BUFFER,a.normal_buffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.Normal_Index_Buffer),c.locNormal=t.getAttribLocation(c.program,"normal"),t.vertexAttribPointer(c.locNormal,3,t.FLOAT,!0,0,0),t.enableVertexAttribArray(c.locNormal),t.bindBuffer(t.ARRAY_BUFFER,a.normalVec_buffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.NormalVec_Index_Buffer),c.locNormalVec=t.getAttribLocation(c.program,"normalVec"),t.vertexAttribPointer(c.locNormalVec,3,t.FLOAT,!0,0,0),t.enableVertexAttribArray(c.locNormalVec),!n){if(a.isLight||c.optionalUniforms.map((async e=>{switch(e.name){case"reflection":var o=e.map;if(o){let a,c=(a=o.split("."))[a.length-1].toLowerCase();switch(e.refTexture=t.createTexture(),c){case"mp4":case"webm":case"avi":case"mkv":case"ogv":e.textureMode="video",i&&(cacheItem=cache.textures.filter((e=>e.url==o))).length?(console.log("found video in cache... using it"),e.video=cacheItem[0].resource,r.datasets=[...r.datasets,{texture:cacheItem[0].texture,iURL:o}]):(e.video=document.createElement("video"),e.video.muted=!0,e.video.playbackRate=e.playbackSpeed,e.video.defaultPlaybackRate=e.playbackSpeed,r.datasets=[...r.datasets,{texture:e.refTexture,iURL:o}],e.video.loop=!0,e.muted||GenericPopup("play audio OK?",!0,(()=>{cache.textures.filter((e=>e.url==o))[0].resource.muted=!1,cache.textures.filter((e=>e.url==o))[0].resource.currentTime=0,cache.textures.filter((e=>e.url==o))[0].resource.play()})),e.video.playbackRate=e.video.defaultPlaybackRate=e.playbackSpeed,e.video.oncanplay=async()=>{e.video.play()},cache.textures.push({url:o,resource:e.video,texture:e.refTexture}),await fetch(o).then((e=>e.blob())).then((a=>{e.video.src=URL.createObjectURL(a)})));break;default:if(e.textureMode="image",i&&(cacheItem=cache.textures.filter((e=>e.url==o))).length){console.log("found image in cache... using it");var n=cacheItem[0].resource;r.datasets=[...r.datasets,{texture:cacheItem[0].texture,iURL:o}],t.activeTexture(t.TEXTURE1),BindImage(t,n,e.refTexture,e.textureMode,-1,o)}else{n=new Image;r.datasets=[...r.datasets,{texture:e.refTexture,iURL:o}],t.activeTexture(t.TEXTURE1),n.onload=()=>{BindImage(t,n,e.refTexture,e.textureMode,-1,o)},cache.textures.push({url:o,resource:n,texture:e.refTexture}),await fetch(o).then((e=>e.blob())).then((e=>{n.src=URL.createObjectURL(e)}))}}}t.useProgram(c.program),e.locRefOmitEquirectangular=t.getUniformLocation(c.program,"refOmitEquirectangular"),t.uniform1f(e.locRefOmitEquirectangular,"rectangle"==a.shapeType||"point light"==a.shapeType||"sprite"==a.shapeType?1:0),e.locRefFlipRefs=t.getUniformLocation(c.program,"refFlipRefs"),t.uniform1f(e.locRefFlipRefs,e.flipReflections),e.locRefTexture=t.getUniformLocation(c.program,"reflectionMap"),t.bindTexture(t.TEXTURE_2D,e.refTexture),t.uniform1i(e.locRefTexture,1),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,e.refTexture);break;case"phong":e.locPhongTheta=t.getUniformLocation(c.program,e.theta),t.uniform1f(e.locPhongTheta,e.theta)}e.locFlatShading=t.getUniformLocation(c.program,e.flatShadingUniform),t.uniform1f(e.locFlatShading,e.flatShading?1:0),e.loc=t.getUniformLocation(c.program,e.name),t[e.dataType](e.loc,e.value)})),c.locColor=t.getUniformLocation(c.program,"color"),t.uniform3f(c.locColor,...HexToRGB(a.color)),c.locColorMix=t.getUniformLocation(c.program,"colorMix"),t.uniform1f(c.locColorMix,a.colorMix),c.locIsSprite=t.getUniformLocation(c.program,"isSprite"),t.uniform1f(c.locIsSprite,a.isSprite),c.locIsLight=t.getUniformLocation(c.program,"isLight"),t.uniform1f(c.locIsLight,a.isLight),c.locAlpha=t.getUniformLocation(c.program,"alpha"),t.uniform1f(c.locAlpha,a.alpha),c.locPointLights=t.getUniformLocation(c.program,"pointLightPos[0]"),c.locPointLightCols=t.getUniformLocation(c.program,"pointLightCol[0]"),c.locPointLightCount=t.getUniformLocation(c.program,"pointLightCount"),t.uniform1i(c.locPointLightCount,0),c.locResolution=t.getUniformLocation(c.program,"resolution"),t.uniform2f(c.locResolution,e.width,e.height),c.locEquirectangular=t.getUniformLocation(c.program,"equirectangular"),t.uniform1f(c.locEquirectangular,a.equirectangular?1:0),c.locT=t.getUniformLocation(c.program,"t"),t.uniform1f(c.locT,0),c.locAmbientLight=t.getUniformLocation(c.program,"ambientLight"),t.uniform1f(c.locAmbientLight,e.ambientLight),c.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,c.texture),c.locTexture=t.getUniformLocation(c.program,"baseTexture"),s){let e;switch(c.iURL=s,(e=s.split("."))[e.length-1].toLowerCase()){case"mp4":case"webm":case"avi":case"mkv":case"ogv":a.textureMode="video",i&&(cacheItem=cache.textures.filter((e=>e.url==c.iURL))).length?(console.log("found video in cache... using it"),c.resource=cacheItem[0].resource,c.texture=cacheItem[0].texture):(c.resource=document.createElement("video"),c.resource.muted=!0,c.resource.playbackRate=c.resource.defaultPlaybackRate=a.playbackSpeed,c.resource.loop=!0,a.muted||GenericPopup("play audio OK?",!0,(()=>{c.resource.muted=!1,c.resource.currentTime=0,c.resource.playbackRate=c.resource.defaultPlaybackRate=c.resource.playbackSpeed,c.resource.play()})),c.resource.playbackRate=c.resource.defaultPlaybackRate=a.playbackSpeed,c.resource.oncanplay=async()=>{c.resource.play()},cache.textures.push({url:s,resource:c.resource,texture:c.texture}),await fetch(s).then((e=>e.blob())).then((e=>{c.resource.src=URL.createObjectURL(e)})));break;default:if(a.textureMode="image",i&&(cacheItem=cache.textures.filter((e=>e.url==s))).length){c.texture=cacheItem[0].texture;var f=cacheItem[0].resource;c.resource=f,t.activeTexture(t.TEXTURE0),BindImage(t,f,c.texture,a.textureMode,-1,s)}else{f=new Image;t.activeTexture(t.TEXTURE0),cache.textures.push({url:s,resource:f,texture:c.texture}),f.onload=()=>{BindImage(t,f,c.texture,a.textureMode,-1,s)},await fetch(s).then((e=>e.blob())).then((e=>{f.src=URL.createObjectURL(e)}))}}}t.useProgram(c.program),t.uniform1i(c.locTexture,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,c.texture),c.locCamPos=t.getUniformLocation(c.program,"camPos"),c.locCamOri=t.getUniformLocation(c.program,"camOri"),c.locGeoPos=t.getUniformLocation(c.program,"geoPos"),c.locGeoOri=t.getUniformLocation(c.program,"geoOri"),c.locFov=t.getUniformLocation(c.program,"fov"),c.locRenderNormals=t.getUniformLocation(c.program,"renderNormals"),t.uniform3f(c.locCamPos,e.x,e.y,e.z),t.uniform3f(c.locCamOri,e.roll,e.pitch,e.yaw),t.uniform3f(c.locGeoPos,e.x,e.y,e.z),t.uniform3f(c.locGeoOri,a.roll,a.pitch,a.yaw),t.uniform1f(c.locFov,e.fov),t.uniform1f(c.locRenderNormals,0)}}else{var p=t.getProgramInfoLog(c.program),m=t.getShaderInfoLog(l),u=t.getShaderInfoLog(h);console.error(`bad shader :( ${p}`),console.error(`vShader info : ${m}`),console.error(`fShader info : ${u}`)}},r},IsPolyhedron=e=>{var a;switch(e){case"tetrahedron":case"cube":case"octahedron":case"dodecahedron":case"icosahedron":case"tetrahedron":case"dynamic":a=!0;break;default:a=!1}return a},GeometryFromRaw=async(e,a,t,o,r,n,i=!1,c="")=>{var s,l,h,f,p,m=[],u=[],d=e,g=[],v=`${c}_${o}`,R=IsPolyhedron(c);if("obj"===c)p=await subbed(0,1,r,d,a,v);else p=await subbed(o+(R?1:0),1,r,d,a,v);for(p.map((e=>{e.verts.map((e=>{e[0]*=t,e[1]*=t,e[2]*=t})),i?(m=[...m,e.verts[0],e.verts[1],e.verts[2],e.verts[2],e.verts[3],e.verts[0]],void 0!==e.uvs&&e.uvs.length&&(u=[...u,e.uvs[0],e.uvs[1],e.uvs[2],e.uvs[2],e.uvs[3],e.uvs[0]])):(m=[...m,...e.verts],void 0!==e.uvs&&e.uvs.length&&(u=[...u,...e.uvs]))})),l=0;l<m.length;l++){var y;h=[m[3*(s=l/3|0)+0],m[3*s+1],m[3*s+2]],l%3||(y=Normal(h,R),n||(y[3]=y[0]+(y[0]-y[3]),y[4]=y[1]+(y[1]-y[4]),y[5]=y[2]+(y[2]-y[5]))),f=n?m.length-l-1:l,g=[...g,{position:m[f],normal:[...m[f],m[f][0]+(y[3]-y[0]),m[f][1]+(y[4]-y[1]),m[f][2]+(y[5]-y[2])],texCoord:u[f]}]}return{geometry:g}},subbed=async(e,a,t,o,r,n="")=>{var i,c,s,l,h,f,p,m,u,d,g,v,R,y,b,E,x,_,A,T,M,I,P,F,S,C,L,B,U,w,N,k,O,D,z,V,G,Y,H,X,W,K,q,j,$,Q,Z,J,ee,ae,te,oe,re,ne,ie,ce,se,le,he,fe,pe,me,ue,de,ge,ve,Re=!1;if(!Re)for(var ye=e;ye--;)i=o,c=r,o=[],r=[],i.map(((e,a)=>{switch(p=e[s=0][0],m=e[s][1],u=e[s][2],c.length&&c[a].length>s&&(ve=c[a],S=ve[s][0],C=ve[s][1]),d=e[s=1][0],g=e[s][1],v=e[s][2],c.length&&c[a].length>s&&(L=ve[s][0],B=ve[s][1]),R=e[s=2][0],y=e[s][1],b=e[s][2],c.length&&c[a].length>s&&(U=ve[s][0],w=ve[s][1]),e.length>3&&(E=e[s=3][0],x=e[s][1],_=e[s][2],c.length&&c[a].length>s&&(N=ve[s][0],k=ve[s][1]),e.length>4&&(A=e[s=4][0],T=e[s][1],M=e[s][2],c.length&&c[a].length>s&&(O=ve[s][0],D=ve[s][1]),e.length>5&&(I=e[s=5][0],P=e[s][1],F=e[s][2],c.length&&c[a].length>s&&(z=ve[s][0],V=ve[s][1])))),G=(p+d)/2,Y=(m+g)/2,H=(u+v)/2,X=(d+R)/2,W=(g+y)/2,K=(v+b)/2,void 0!==S&&(ee=(S+L)/2,ae=(C+B)/2,te=(L+U)/2,oe=(B+w)/2),me=[],ue=[],e.length){case 3:q=(R+p)/2,j=(y+m)/2,$=(b+u)/2,void 0!==S&&(re=(U+S)/2,ne=(w+C)/2,l=S,h=C,ue=[...ue,[l,h]],l=ee,h=ae,ue=[...ue,[l,h]],l=re,h=ne,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=ee,h=ae,ue=[...ue,[l,h]],l=L,h=B,ue=[...ue,[l,h]],l=te,h=oe,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=re,h=ne,ue=[...ue,[l,h]],l=te,h=oe,ue=[...ue,[l,h]],l=U,h=w,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=ee,h=ae,ue=[...ue,[l,h]],l=te,h=oe,ue=[...ue,[l,h]],l=re,h=ne,ue=[...ue,[l,h]],r=[...r,ue]),l=p,h=m,f=u,me=[...me,[l,h,f]],l=G,h=Y,f=H,me=[...me,[l,h,f]],l=q,h=j,f=$,me=[...me,[l,h,f]],o=[...o,me],me=[],l=G,h=Y,f=H,me=[...me,[l,h,f]],l=d,h=g,f=v,me=[...me,[l,h,f]],l=X,h=W,f=K,me=[...me,[l,h,f]],o=[...o,me],me=[],l=q,h=j,f=$,me=[...me,[l,h,f]],l=X,h=W,f=K,me=[...me,[l,h,f]],l=R,h=y,f=b,me=[...me,[l,h,f]],o=[...o,me],me=[],l=G,h=Y,f=H,me=[...me,[l,h,f]],l=X,h=W,f=K,me=[...me,[l,h,f]],l=q,h=j,f=$,me=[...me,[l,h,f]],o=[...o,me];break;case 4:q=(R+E)/2,j=(y+x)/2,$=(b+_)/2,Q=(E+p)/2,Z=(x+m)/2,J=(_+u)/2,void 0!==S&&(re=(U+N)/2,ne=(w+k)/2,ie=(N+S)/2,ce=(k+C)/2,de=(S+L+U+N)/4,ge=(C+B+w+k)/4,l=S,h=C,ue=[...ue,[l,h]],l=ee,h=ae,ue=[...ue,[l,h]],l=de,h=ge,ue=[...ue,[l,h]],l=ie,h=ce,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=ee,h=ae,ue=[...ue,[l,h]],l=L,h=B,ue=[...ue,[l,h]],l=te,h=oe,ue=[...ue,[l,h]],l=de,h=ge,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=de,h=ge,ue=[...ue,[l,h]],l=te,h=oe,ue=[...ue,[l,h]],l=U,h=w,ue=[...ue,[l,h]],l=re,h=ne,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=ie,h=ce,ue=[...ue,[l,h]],l=de,h=ge,ue=[...ue,[l,h]],l=re,h=ne,ue=[...ue,[l,h]],l=N,h=k,ue=[...ue,[l,h]],r=[...r,ue]),se=(p+d+R+E)/4,le=(m+g+y+x)/4,he=(u+v+b+_)/4,l=p,h=m,f=u,me=[...me,[l,h,f]],l=G,h=Y,f=H,me=[...me,[l,h,f]],l=se,h=le,f=he,me=[...me,[l,h,f]],l=Q,h=Z,f=J,me=[...me,[l,h,f]],o=[...o,me],me=[],l=G,h=Y,f=H,me=[...me,[l,h,f]],l=d,h=g,f=v,me=[...me,[l,h,f]],l=X,h=W,f=K,me=[...me,[l,h,f]],l=se,h=le,f=he,me=[...me,[l,h,f]],o=[...o,me],me=[],l=se,h=le,f=he,me=[...me,[l,h,f]],l=X,h=W,f=K,me=[...me,[l,h,f]],l=R,h=y,f=b,me=[...me,[l,h,f]],l=q,h=j,f=$,me=[...me,[l,h,f]],o=[...o,me],me=[],l=Q,h=Z,f=J,me=[...me,[l,h,f]],l=se,h=le,f=he,me=[...me,[l,h,f]],l=q,h=j,f=$,me=[...me,[l,h,f]],l=E,h=x,f=_,me=[...me,[l,h,f]],o=[...o,me];break;case 5:se=(p+d+R+E+A)/5,le=(m+g+y+x+T)/5,he=(u+v+b+_+M)/5,void 0!==S&&(de=(S+L+U+N+O)/5,ge=(C+B+w+k+D)/5,re=(U+N)/2,ne=(w+k)/2,ie=(N+O)/2,ce=(k+D)/2,(O+S)/2,(D+C)/2,l=S,h=C,ue=[...ue,[l,h]],l=L,h=B,ue=[...ue,[l,h]],l=de,h=ge,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=L,h=B,ue=[...ue,[l,h]],l=U,h=w,ue=[...ue,[l,h]],l=de,h=ge,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=U,h=w,ue=[...ue,[l,h]],l=N,h=k,ue=[...ue,[l,h]],l=de,h=ge,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=N,h=k,ue=[...ue,[l,h]],l=O,h=D,ue=[...ue,[l,h]],l=de,h=ge,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=O,h=D,ue=[...ue,[l,h]],l=S,h=C,ue=[...ue,[l,h]],l=de,h=ge,ue=[...ue,[l,h]],r=[...r,ue],ue=[]),q=(R+E)/2,j=(y+x)/2,$=(b+_)/2,Q=(E+A)/2,Z=(x+T)/2,J=(_+M)/2,(A+p)/2,(T+m)/2,(M+u)/2,l=p,h=m,f=u,me=[...me,[l,h,f]],l=d,h=g,f=v,me=[...me,[l,h,f]],l=se,h=le,f=he,me=[...me,[l,h,f]],o=[...o,me],me=[],l=d,h=g,f=v,me=[...me,[l,h,f]],l=R,h=y,f=b,me=[...me,[l,h,f]],l=se,h=le,f=he,me=[...me,[l,h,f]],o=[...o,me],me=[],l=R,h=y,f=b,me=[...me,[l,h,f]],l=E,h=x,f=_,me=[...me,[l,h,f]],l=se,h=le,f=he,me=[...me,[l,h,f]],o=[...o,me],me=[],l=E,h=x,f=_,me=[...me,[l,h,f]],l=A,h=T,f=M,me=[...me,[l,h,f]],l=se,h=le,f=he,me=[...me,[l,h,f]],o=[...o,me],me=[],l=A,h=T,f=M,me=[...me,[l,h,f]],l=p,h=m,f=u,me=[...me,[l,h,f]],l=se,h=le,f=he,me=[...me,[l,h,f]],o=[...o,me],me=[];break;case 6:se=(p+d+R+E+A)/5,le=(m+g+y+x+T)/5,he=(u+v+b+_+M)/5,void 0!==S&&(de=(S+L+U+N+O+z)/6,ge=(C+B+w+k+D+V)/6,re=(U+N)/2,ne=(w+k)/2,ie=(N+O)/2,ce=(k+D)/2,(O+z)/2,(D+V)/2,(z+S)/2,(V+C)/2,l=S,h=C,ue=[...ue,[l,h]],l=L,h=B,ue=[...ue,[l,h]],l=de,h=ge,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=L,h=B,ue=[...ue,[l,h]],l=U,h=w,ue=[...ue,[l,h]],l=de,h=ge,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=U,h=w,ue=[...ue,[l,h]],l=N,h=k,ue=[...ue,[l,h]],l=de,h=ge,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=N,h=k,ue=[...ue,[l,h]],l=O,h=D,ue=[...ue,[l,h]],l=de,h=ge,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=O,h=D,ue=[...ue,[l,h]],l=z,h=V,ue=[...ue,[l,h]],l=de,h=ge,ue=[...ue,[l,h]],r=[...r,ue],ue=[],l=z,h=V,ue=[...ue,[l,h]],l=S,h=C,ue=[...ue,[l,h]],l=de,h=ge,ue=[...ue,[l,h]],r=[...r,ue],ue=[]),q=(R+E)/2,j=(y+x)/2,$=(b+_)/2,Q=(E+A)/2,Z=(x+T)/2,J=(_+M)/2,(A+I)/2,(T+P)/2,(M+F)/2,(I+p)/2,(P+m)/2,(F+u)/2,l=p,h=m,f=u,me=[...me,[l,h,f]],l=d,h=g,f=v,me=[...me,[l,h,f]],l=se,h=le,f=he,me=[...me,[l,h,f]],o=[...o,me],me=[],l=d,h=g,f=v,me=[...me,[l,h,f]],l=R,h=y,f=b,me=[...me,[l,h,f]],l=se,h=le,f=he,me=[...me,[l,h,f]],o=[...o,me],me=[],l=R,h=y,f=b,me=[...me,[l,h,f]],l=E,h=x,f=_,me=[...me,[l,h,f]],l=se,h=le,f=he,me=[...me,[l,h,f]],o=[...o,me],me=[],l=E,h=x,f=_,me=[...me,[l,h,f]],l=A,h=T,f=M,me=[...me,[l,h,f]],l=se,h=le,f=he,me=[...me,[l,h,f]],o=[...o,me],me=[],l=A,h=T,f=M,me=[...me,[l,h,f]],l=I,h=P,f=F,me=[...me,[l,h,f]],l=se,h=le,f=he,me=[...me,[l,h,f]],o=[...o,me],me=[],l=I,h=P,f=F,me=[...me,[l,h,f]],l=p,h=m,f=u,me=[...me,[l,h,f]],l=se,h=le,f=he,me=[...me,[l,h,f]],o=[...o,me],me=[]}}));if(t){var be;fe=t,pe=1-t;for(ye=2;ye--;)(ye?o:r).map((e=>{e.map((e=>{l=e[0],h=e[1],f=ye?e[2]:0,be=Math.hypot(l,h,f),l/=be,h/=be,f/=be,e[0]=l*=fe+be*pe,e[1]=h*=fe+be*pe,ye&&(e[2]=f*=fe+be*pe)}))}))}return o.map(((e,a)=>({verts:e,uvs:r[a]})))},Camera=(e=0,a=0,t=0,o=0,r=0,n=0)=>({x:e,y:a,z:t,roll:o,pitch:r,yaw:n}),GeoSphere=(e,a,t,o,r)=>{let n,i,c,s,l,h,f,p,m,u,d,g,v,R,y=Array(o).fill().map((e=>(n=Rn()-.5,i=Rn()-.5,c=Rn()-.5,[n,i,c])));for(let e=99;e--;)y.map(((e,a)=>{n=e[0],i=e[1],c=e[2],y.map(((e,t)=>{t!=a&&(f=e[0],p=e[1],m=e[2],d=1+(Math.hypot(n-f,i-p,c-m)*(3+o/70)*3)**3,n+=9*(n-f)/d,i+=9*(i-p)/d,c+=9*(c-m)/d)})),d=Math.hypot(n,i,c),e[0]=n/d,e[1]=i/d,e[2]=c/d}));return u=6e6,y.map(((e,a)=>{s=e[0],l=e[1],h=e[2],y.map(((e,t)=>{f=e[0],p=e[1],m=e[2],a!=t&&(d=Math.hypot(g=s-f,v=l-p,R=h-m),d<u&&(u=d))}))})),g=[],y.map(((e,a)=>{s=e[0],l=e[1],h=e[2],y.map(((e,t)=>{f=e[0],p=e[1],m=e[2],a!=t&&(d=Math.hypot(s-f,l-p,h-m),d<2*u&&(g.filter((e=>e[0]==f&&e[1]==p&&e[2]==m&&e[3]==s&&e[4]==l&&e[5]==h)).length||(g=[...g,[s*r,l*r,h*r,f*r,p*r,m*r]])))}))})),y.map((o=>{o[0]*=r/1.3333,o[1]*=r/1.3333,o[2]*=r/1.3333,o[0]+=e,o[1]+=a,o[2]+=t})),[e,a,t,r,y,g]},Cylinder=async(e=1,a=0,t=0,o=!1,r,n,i)=>{for(var c,s,l,h,f,p,m,u,d,g,v,R,y,b,E,x,_,A,T,M,I=[],P=[],F=0;F<n;F++)for(var L=F-.5,B=0;B<i;B++){c=S(2*Math.PI/i*B),s=1/n*L-.5,l=C(2*Math.PI/i*B),h=S(2*Math.PI/i*(B+1)),f=1/n*L-.5,p=C(2*Math.PI/i*(B+1)),m=S(2*Math.PI/i*(B+1)),u=1/n*(L+1)-.5,d=C(2*Math.PI/i*(B+1)),g=S(2*Math.PI/i*B),v=1/n*(L+1)-.5,R=C(2*Math.PI/i*B);var U=Math.atan2(c,l),w=Math.atan2(h,p),N=Math.atan2(m,d),k=Math.atan2(g,R);Math.abs(U-w)>Math.PI&&(U-=2*Math.PI,k-=2*Math.PI),y=(U+Math.PI)/Math.PI/2,b=s+.5,E=(w+Math.PI)/Math.PI/2,x=f+.5,_=(N+Math.PI)/Math.PI/2,A=u+.5,T=(k+Math.PI)/Math.PI/2,M=v+.5,I=[...I,[[c,s,l],[h,f,p],[m,u,d],[g,v,R]]],P=[...P,[[y,b],[E,x],[_,A],[T,M]]]}return await GeometryFromRaw(I,P,e/1.2,a,t,o,!0,r)},Torus=async(e=1,a=0,t=0,o=!1,r,n,i)=>{for(var c,s,l,h,f,p,m,u,d,g,v,R,y,b,E,x,_,A,T,M,I,P,F,L,B=[],U=[],w=4*n,N=.5,k=1.25,O=0;O<w;O++)for(var D=O+.5,z=0;z<i;z++){c=S(F=2*Math.PI/i*z)*N+k,s=C(F)*N,0,F=Math.atan2(c,0)+2*Math.PI/w*D+Math.PI/2,L=Math.hypot(c,0),l=S(F)*L,h=s,f=C(F)*L,c=S(F=2*Math.PI/i*(z+1))*N+k,s=C(F)*N,F=Math.atan2(c,0)+2*Math.PI/w*D+Math.PI/2,L=Math.hypot(c,0),p=S(F)*L,m=s,u=C(F)*L,c=S(F=2*Math.PI/i*(z+1))*N+k,s=C(F)*N,F=Math.atan2(c,0)+2*Math.PI/w*(D+1)+Math.PI/2,L=Math.hypot(c,0),d=S(F)*L,g=s,v=C(F)*L,c=S(F=2*Math.PI/i*z)*N+k,s=C(F)*N,F=Math.atan2(c,0)+2*Math.PI/w*(D+1)+Math.PI/2,L=Math.hypot(c,0),R=S(F)*L,y=s,b=C(F)*L;var V=Math.atan2(l,f),G=Math.atan2(p,u),Y=Math.atan2(d,v),H=Math.atan2(R,b);Math.abs(V-Y)>Math.PI&&(Y+=2*Math.PI,H+=2*Math.PI),E=(V+Math.PI)/Math.PI/2,x=h+.5,_=(G+Math.PI)/Math.PI/2,A=m+.5,T=(Y+Math.PI)/Math.PI/2,M=g+.5,I=(H+Math.PI)/Math.PI/2,P=y+.5,B=[...B,[[l,h,f],[p,m,u],[d,g,v],[R,y,b]]],U=[...U,[[E,x],[_,A],[T,M],[I,P]]]}return await GeometryFromRaw(B,U,e/1.2,a,t,o,!0,r)},TorusKnot=async(e=1,a=0,t=0,o=!1,r,n,i)=>{var c,s,l,h,f,p,m,u,d,g,v,R,y,b,E,x,_,A,T,M,I,P,F,L,B,U=[],w=[],N=8*n;i/=1;for(var k,O,D,z,V,G,Y,H=.75,X=0;X<2*N;X++)for(var W=0;W<i;W++){var K=X+.5,q=X+1.5,j=X+2.5;h=3+S(k=2*Math.PI*1.5*1/N*K)/1,f=G=2*C(k),m=3+S(O=2*Math.PI*1.5*1/N*q)/1,u=Y=2*C(O),g=3+S(D=2*Math.PI*1.5*1/N*j)/1,v=2*C(D),z=(Math.acos((u-f)/(Math.hypot(m-h,u-f)+1e-4))-Math.PI/2)/2,V=(Math.acos((v-u)/(Math.hypot(g-m,v-u)+1e-4))-Math.PI/2)/2;var $=3+S(k)/1;c=S(L=2*Math.PI/i*W)*H+$,s=C(L)*H+G,l=0,L=Math.atan2(s,l)+z,B=Math.hypot(s,l),s=S(L)*B,l=C(L)*B,L=Math.atan2(c,l)+2*Math.PI/N*K+Math.PI/2,B=Math.hypot(c,l),h=S(L)*B,f=s,p=C(L)*B,c=S(L=2*Math.PI/i*(W+1))*H+$,s=C(L)*H+G,l=0,L=Math.atan2(s,l)+z,B=Math.hypot(s,l),s=S(L)*B,l=C(L)*B,L=Math.atan2(c,l)+2*Math.PI/N*K+Math.PI/2,B=Math.hypot(c,l),m=S(L)*B,u=s,d=C(L)*B,$=3+S(O)/1,c=S(L=2*Math.PI/i*(W+1))*H+$,s=C(L)*H+Y,l=0,L=Math.atan2(s,l)+V,B=Math.hypot(s,l),s=S(L)*B,l=C(L)*B,L=Math.atan2(c,l)+2*Math.PI/N*q+Math.PI/2,B=Math.hypot(c,l),g=S(L)*B,v=s,R=C(L)*B,c=S(L=2*Math.PI/i*W)*H+$,s=C(L)*H+Y,l=0,L=Math.atan2(s,l)+V,B=Math.hypot(s,l),s=S(L)*B,l=C(L)*B,L=Math.atan2(c,l)+2*Math.PI/N*q+Math.PI/2,B=Math.hypot(c,l),y=S(L)*B,b=s,E=C(L)*B;var Q=Math.atan2(h,p),Z=Math.atan2(m,d),J=Math.atan2(g,R),ee=Math.atan2(y,E);Math.abs(Q-J)>Math.PI&&(J+=2*Math.PI,ee+=2*Math.PI),x=(Q+Math.PI)/Math.PI/2,_=f+.5,A=(Z+Math.PI)/Math.PI/2,T=u+.5,M=(J+Math.PI)/Math.PI/2,I=v+.5,P=(ee+Math.PI)/Math.PI/2,F=b+.5,U=[...U,[[h,f,p],[m,u,d],[g,v,R],[y,b,E]]],w=[...w,[[x,_],[A,T],[M,I],[P,F]]]}return await GeometryFromRaw(U,w,e/1.2,a,t,o,!0,r)},Tetrahedron=async(e=1,a=0,t=0,o=!1,r)=>{var n,i,c,s,l,h,f,p,m,u,d,g,v,R=[];g=[];let y=1/1.4142/1.25;for(u=3;u--;)n=1*S(s=2*Math.PI/3*u)/1.25,i=1*C(s)/1.25,c=y,g=[...g,[n,i,c]];for(R=[...R,g],d=3;d--;)g=[],n=0,i=0,c=-y,g=[...g,[n,i,c]],n=1*S(s=2*Math.PI/3*d)/1.25,i=1*C(s)/1.25,c=y,g=[...g,[n,i,c]],n=1*S(s=2*Math.PI/3*(d+1))/1.25,i=1*C(s)/1.25,c=y,g=[...g,[n,i,c]],R=[...R,g];f=p=m=v=0,R.map((e=>{e.map((e=>{f+=e[0],p+=e[1],m+=e[2],v++}))})),f/=v,p/=v,m/=v,R.map((e=>{e.map((e=>{e[0]-=f,e[1]-=p,e[2]-=m}))}));var b=R,E=[];for(u=0;u<b.length;u++){g=[];for(var x=b[u].length;x--;){switch(x){case 0:l=0,h=0;break;case 1:l=1,h=0;break;case 2:l=1,h=1;break;case 3:l=0,h=.5;break;case 4:l=0,h=1}g=[...g,[l,h]]}E=[...E,g]}return await GeometryFromRaw(b,E,e,a,t,o,!1,r)},Octahedron=async(e=1,a=0,t=0,o=!1,r)=>{var n,i,c,s,l,h,f,p,m,u=[];for(p=8;p--;)m=[],n=0,i=0,c=.8*(p<4?-1:1),m=[...m,[n,i,c]],n=1*S(s=2*Math.PI/4*p)/1.25,i=1*C(s)/1.25,c=0,m=[...m,[n,i,c]],n=1*S(s=2*Math.PI/4*(p+1))/1.25,i=1*C(s)/1.25,c=0,m=[...m,[n,i,c]],u=[...u,m];var d=u,g=[];for(f=0;f<d.length;f++){m=[];for(var v=d[f].length;v--;){switch(v){case 0:l=0,h=0;break;case 1:l=1,h=0;break;case 2:l=1,h=1;break;case 3:l=0,h=.5;break;case 4:l=0,h=1}m=[...m,[l,h]]}g=[...g,m]}return await GeometryFromRaw(d,g,e,a,t,o,!1,r)},Icosahedron=async(e=1,a=0,t=0,o=!1,r)=>{var n,i,c,s,l,h,f,p,m,u,d,g,v,R,y,b=[];for(p=[[-(f=.5+5**.5/2),-1,0],[f,-1,0],[f,1,0],[-f,1,0]],h=3;h--;b=[...b,i])for(i=[],n=4;n--;)i=[...i,[p[n][h],p[n][(h+1)%3],p[n][(h+2)%3]]];b.map((e=>{e.map((e=>{e[0]*=1/2.25,e[1]*=1/2.25,e[2]*=1/2.25}))})),m=JSON.parse(JSON.stringify(b)),l=[],p=[],[[[0,3],[1,0],[2,2]],[[0,3],[1,0],[1,3]],[[0,3],[2,3],[1,3]],[[0,2],[2,1],[1,0]],[[0,2],[1,3],[1,0]],[[0,2],[1,3],[2,0]],[[0,3],[2,2],[0,0]],[[1,0],[2,2],[2,1]],[[1,1],[2,2],[2,1]],[[1,1],[2,2],[0,0]],[[1,1],[2,1],[0,1]],[[0,2],[2,1],[0,1]],[[2,0],[1,2],[2,3]],[[0,0],[0,3],[2,3]],[[1,3],[2,0],[2,3]],[[2,3],[0,0],[1,2]],[[1,2],[2,0],[0,1]],[[0,0],[1,2],[1,1]],[[0,1],[1,2],[1,1]],[[0,2],[2,0],[0,1]]].map((e=>{u=e[0][0],d=e[1][0],g=e[2][0],v=e[0][1],R=e[1][1],y=e[2][1],p=[...p,[m[u][v],m[d][R],m[g][y]]]}));var E=l=[...l,...p],x=[];for(n=0;n<E.length;n++){p=[];for(var _=E[n].length;_--;){switch(_){case 0:c=0,s=0;break;case 1:c=1,s=0;break;case 2:c=1,s=1;break;case 3:c=0,s=.5;break;case 4:c=0,s=1}p=[...p,[c,s]]}x=[...x,p]}return await GeometryFromRaw(E,x,e,a,t,o,!1,r)},Dodecahedron=async(e=1,a=0,t=0,o=!1,r)=>{var n,i,c,s,l,h,f,p,m,u,d=[],g=[];let v=-6e6;for(u=5;u--;)n=S(h=2*Math.PI/5*u+Math.PI/5),i=C(h),c=0,i>v&&(v=i),g=[...g,[n,i,c]];g=g.map((e=>(n=e[0],i=e[1]-=v,c=e[2],R(n,i,c,{x:0,y:0,z:0,roll:0,pitch:.553573,yaw:0})))),(l=structuredClone(g)).map((e=>{e[1]*=-1})),d=[...d,g,l],v=-6e6,d.map((e=>{e.map((e=>{n=e[0],i=e[1],(c=e[2])>v&&(v=c)}))})),s=Math.hypot(d[0][0][0]-d[0][1][0],d[0][0][1]-d[0][1][1],d[0][0][2]-d[0][1][2]),d.map((e=>{e.map((e=>{e[2]-=v+s/2}))})),(l=structuredClone(d)).map((e=>{e.map((e=>{e[2]*=-1}))})),d=[...d,...l],(l=structuredClone(d)).map((e=>{e.map((e=>{n=e[0],i=e[1],c=e[2],f=R(n,i,c,{x:0,y:0,z:0,roll:0,pitch:0,yaw:Math.PI/2}),f=R(f[0],f[1],f[2],{x:0,y:0,z:0,roll:0,pitch:Math.PI/2,yaw:0}),e[0]=f[0],e[1]=f[1],e[2]=f[2]}))})),(y=structuredClone(d)).map((e=>{e.map((e=>{n=e[0],i=e[1],c=e[2],f=R(n,i,c,{x:0,y:0,z:0,roll:0,pitch:0,yaw:Math.PI/2}),f=R(f[0],f[1],f[2],{x:0,y:0,z:0,roll:Math.PI/2,pitch:0,yaw:0}),e[0]=f[0],e[1]=f[1],e[2]=f[2]}))}));var y=d=[...d,...l,...y],b=[];for(u=0;u<y.length;u++){g=[];for(var E=y[u].length;E--;){switch(E){case 0:p=0,m=0;break;case 1:p=1,m=0;break;case 2:p=1,m=1;break;case 3:p=0,m=.5;break;case 4:p=0,m=1}g=[...g,[p,m]]}b=[...b,g]}return await GeometryFromRaw(y,b,e/Math.max(1,2-t),a,t,o,!1,r)},Cube=async(e=1,a=0,t=0,o=!1,r)=>{var n,i,c,s,l,h,f,p,m=Math.PI,u=[];for(l=6;l--;u=[...u,c])for(c=[],h=4;h--;)c=[...c,[(i=[S(n=2*m/4*h+m/4),C(n),2**.5/2])[l%3]*(s=l<3?1:-1),i[(l+1)%3]*s,i[(l+2)%3]*s]];var d=[];for(l=0;l<u.length;l++){i=[];for(var g=u[l].length;g--;){switch(g){case 0:f=0,p=0;break;case 1:f=1,p=0;break;case 2:f=1,p=1;break;case 3:f=0,p=1}i=[...i,[f,p]]}d=[...d,i]}return await GeometryFromRaw(u,d,e/1.2,a,t,o,!0,r)},Rectangle=async(e=1,a=0,t=0,o=!1,r)=>{var n;Math.PI;n=[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]]];return await GeometryFromRaw(n,[[[0,0],[1,0],[1,1],[0,1]]],e/1.5,Math.max("sprite"==r?1:2,a),t,o,!0,r)},IsPowerOf2=(e,a=0)=>!(a>300)&&(2==e||IsPowerOf2(e/2,a+1)),Normal=(e,a=!1,t=0,o=0,r=0)=>{var n,i,c=0,s=0,l=0;e.map((e=>{c+=e[0],s+=e[1],l+=e[2]})),c/=e.length,s/=e.length,l/=e.length;var h=e[2][0]-e[1][0],f=e[2][1]-e[1][1],p=e[2][2]-e[1][2],m=e[1][0]-e[0][0],u=e[1][1]-e[0][1],d=e[1][2]-e[0][2];n=[f*d-p*u,p*m-h*d,h*u-f*m],i=Math.hypot(...n)+1e-4;n=n.map((e=>e/i*1));var g=c,v=s,R=l,y=1;if(a){var b=Math.hypot(g-t,v-o,R-r);y=Math.hypot(t-(c+n[0]/99),o-(s+n[1]/99),r-(l+n[2]/99))>b?-1:1}return[g,v,R,c+(n[0]*=y),s+(n[1]*=y),l+(n[2]*=y)]},AnimationLoop=(e,a)=>{const t=()=>{if(e.ready&&void 0!==window[a]&&window[a](),e.spriteQueue.length){var o,r=[];e.spriteQueue.map(((a,t)=>{var n=a.x+e.x,i=a.y+e.y,c=a.z+e.z;o=R(n,i,c,{roll:e.roll,pitch:e.pitch,yaw:e.yaw},!1);var s=e.z/1e3*Math.pow(5,Math.log(e.fov)/1.609438);r=[...r,{idx:t,z:s+o[2]}]})),r.sort(((e,a)=>a.z-e.z)),e.ctx.blendFunc(e.ctx.SRC_ALPHA,e.ctx.ONE),e.ctx.enable(e.ctx.BLEND),e.spriteQueue.map((async(a,t)=>{var o=e.spriteQueue[r[t].idx];o.disableDepthTest&&e.ctx.disable(e.ctx.DEPTH_TEST),await e.Draw(o,!0),o.disableDepthTest&&e.ctx.enable(e.ctx.DEPTH_TEST)})),e.ctx.blendFunc(e.ctx.ONE,e.ctx.ZERO),e.ctx.disable(e.ctx.BLEND)}e.t+=1/60,requestAnimationFrame(t),e.spriteQueue=[]};window.addEventListener("load",(()=>{e.ready=!0,t()}))},RGBToHSV=(e,a,t)=>HSVFromRGB(e,a,t),HSVFromRGB=(e,a,t)=>{let o=e/255,r=a/255,n=t/255,i=Math.min(o,r,n),c=Math.max(o,r,n),s=c,l=c-i,h=c?l/c:0,f=Math.min(e,a,t),p=Math.max(e,a,t),m=0;for(l&&(e>=a&&e>=t&&(m=(a-t)/(p-f)),a>=e&&a>=t&&(m=2+(t-e)/(p-f)),t>=a&&t>=e&&(m=4+(e-a)/(p-f))),m*=60;m<0;)m+=360;for(;m>=360;)m-=360;return[m,h,s]},HSVToHex=(e,a,t)=>HexFromHSV(e,a,t),HexFromHSV=(e,a,t)=>{let o=RGBFromHSV(e,a,t);return RGBToHex(...o)},HSVToRGB=(e,a,t)=>RGBFromHSV(e,a,t),RGBFromHSV=(e,a,t)=>{for(;e<0;)e+=360;for(;e>=360;)e-=360;let o,r,n,i=t*a,c=i*(1-Math.abs(e/60%2-1)),s=t-i;return e>=0&&e<60&&(o=i,r=c,n=0),e>=60&&e<120&&(o=c,r=i,n=0),e>=120&&e<180&&(o=0,r=i,n=c),e>=180&&e<240&&(o=0,r=c,n=i),e>=240&&e<300&&(o=c,r=0,n=i),e>=300&&e<360&&(o=i,r=0,n=c),[255*(o+s),255*(r+s),255*(n+s)]},HexFromRGB=(e,a,t)=>RGBToHex(e,a,t),RGBToHex=(e,a,t)=>{let o="0123456789abcdef",r="";return r+=o[e/16|0],r+=o[e-16*(e/16|0)|0],r+=o[a/16|0],r+=o[a-16*(a/16|0)|0],r+=o[t/16|0],r+=o[t-16*(t/16|0)|0],Number("0x"+r)},RGBFromHex=e=>HexToRGB(e),HexToRGB=e=>[e/256**3-(e/256**3|0),e/65536-(e/65536|0),e/256-(e/256|0)],getParams=e=>{var a=[];["COPY_READ_BUFFER_BINDING","COPY_WRITE_BUFFER_BINDING","DRAW_BUFFERi","DRAW_FRAMEBUFFER_BINDING","FRAGMENT_SHADER_DERIVATIVE_HINT","MAX_3D_TEXTURE_SIZE","MAX_ARRAY_TEXTURE_LAYERS","MAX_CLIENT_WAIT_TIMEOUT_WEBGL","MAX_COLOR_ATTACHMENTS","MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS","MAX_COMBINED_UNIFORM_BLOCKS","MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS","MAX_DRAW_BUFFERS","MAX_ELEMENT_INDEX","MAX_ELEMENTS_INDICES","MAX_ELEMENTS_VERTICES","MAX_FRAGMENT_INPUT_COMPONENTS","MAX_FRAGMENT_UNIFORM_BLOCKS","MAX_FRAGMENT_UNIFORM_COMPONENTS","MAX_PROGRAM_TEXEL_OFFSET","MAX_SAMPLES","MAX_SERVER_WAIT_TIMEOUT","MAX_TEXTURE_LOD_BIAS","MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS","MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS","MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS","MAX_UNIFORM_BLOCK_SIZE","MAX_UNIFORM_BUFFER_BINDINGS","MAX_VARYING_COMPONENTS","MAX_VERTEX_OUTPUT_COMPONENTS","MAX_VERTEX_UNIFORM_BLOCKS","MAX_VERTEX_UNIFORM_COMPONENTS","MIN_PROGRAM_TEXEL_OFFSET","PACK_ROW_LENGTH","PACK_SKIP_PIXELS","PACK_SKIP_ROWS","PIXEL_PACK_BUFFER_BINDING","PIXEL_UNPACK_BUFFER_BINDING","RASTERIZER_DISCARD","READ_BUFFER","READ_FRAMEBUFFER_BINDING","SAMPLE_ALPHA_TO_COVERAGE","SAMPLE_COVERAGE","SAMPLER_BINDING","TEXTURE_BINDING_2D_ARRAY","TEXTURE_BINDING_3D","TRANSFORM_FEEDBACK_ACTIVE","TRANSFORM_FEEDBACK_BINDING","TRANSFORM_FEEDBACK_BUFFER_BINDING","TRANSFORM_FEEDBACK_PAUSED","UNIFORM_BUFFER_BINDING","UNIFORM_BUFFER_OFFSET_ALIGNMENT","UNPACK_IMAGE_HEIGHT","UNPACK_ROW_LENGTH","UNPACK_SKIP_IMAGES","UNPACK_SKIP_PIXELS","UNPACK_SKIP_ROWS","VERTEX_ARRAY_BINDING"].map((t=>{a.push({name:t,val:e.getParameter(e[t])})}));var t=document.createElement("div");t.style.position="fixed",t.style.zIndex=1e5,t.style.left="50%",t.style.top="50%",t.style.transform="translate(-50%, -50%)",t.style.background="#0008",t.style.padding="20px",t.style.width="600px",t.style.height="350px",t.style.border="1px solid #fff4",t.style.borderRadius="5px",t.style.fontFamily="monospace",t.style.fontSize="20px",t.style.color="#fff";var o=document.createElement("div");o.style.fontSize="24px",o.style.color="#0f8c",o.innerHTML="rendering context parameters<br><br>",t.appendChild(o);var r=document.createElement("div");r.style.minWidth="100%",r.style.height="250px",r.style.background="#333",r.style.border="1px solid #fff4",r.style.overflowY="auto",r.style.wordWrap="break-word",r.style.color="#888",r.style.fontSize="10px",t.appendChild(r);var n=document.createElement("button");n.style.border="none",n.style.padding="3px",n.style.cursor="pointer",n.fontSize="20px",n.style.borderRadius="10px",n.style.margin="10px",n.style.minWidth="100px",n.innerHTML="📋 copy",n.title="copy shape data to clipboard",n.onclick=()=>{var e=document.createRange();e.selectNode(r),window.getSelection().removeAllRanges(),window.getSelection().addRange(e),document.execCommand("copy"),window.getSelection().removeAllRanges(),n.innerHTML="COPIED!",setTimeout((()=>{n.innerHTML="📋 copy"}),1e3)},t.appendChild(n);var i=document.createElement("button");i.onclick=()=>t.remove(),i.style.border="none",i.style.padding="3px",i.style.cursor="pointer",i.fontSize="20px",i.style.borderRadius="10px",i.style.margin="10px",i.style.background="#faa",i.style.minWidth="100px",i.innerHTML="close",t.appendChild(i),r.innerHTML=JSON.stringify(a),document.body.appendChild(t)};export{Renderer,LoadGeometry,BasicShader,DestroyViewport,AnimationLoop,Tetrahedron,Cube,Octahedron,Icosahedron,Dodecahedron,Cylinder,Torus,TorusKnot,Rectangle,Q,R,AverageNormals,Normal,ImageToPo2,LoadOBJ,IsPowerOf2,RGBToHSV,HSVToHex,HexFromHSV,HSVToRGB,RGBFromHSV,HexFromRGB,RGBToHex,RGBFromHex,HexToRGB,GeoSphere};

